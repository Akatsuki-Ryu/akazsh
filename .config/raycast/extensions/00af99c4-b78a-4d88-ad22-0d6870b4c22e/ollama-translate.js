"use strict";var lc=Object.create;var Or=Object.defineProperty;var uc=Object.getOwnPropertyDescriptor;var fc=Object.getOwnPropertyNames;var dc=Object.getPrototypeOf,mc=Object.prototype.hasOwnProperty;var Nt=(a,t)=>()=>(a&&(t=a(a=0)),t);var Ir=(a,t)=>()=>(t||a((t={exports:{}}).exports,t),t.exports),ci=(a,t)=>{for(var r in t)Or(a,r,{get:t[r],enumerable:!0})},li=(a,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of fc(t))!mc.call(a,s)&&s!==r&&Or(a,s,{get:()=>t[s],enumerable:!(i=uc(t,s))||i.enumerable});return a};var X=(a,t,r)=>(r=a!=null?lc(dc(a)):{},li(t||!a||!a.__esModule?Or(r,"default",{value:a,enumerable:!0}):r,a)),hc=a=>li(Or({},"__esModule",{value:!0}),a);var yi=Ir((Ur,bi)=>{(function(a,t){typeof Ur=="object"&&typeof bi<"u"?t(Ur):typeof define=="function"&&define.amd?define(["exports"],t):(a=typeof globalThis<"u"?globalThis:a||self,t(a.WebStreamsPolyfill={}))})(Ur,(function(a){"use strict";let t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol:e=>`Symbol(${e})`;function r(){}function i(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}let s=i();function c(e){return typeof e=="object"&&e!==null||typeof e=="function"}let u=r,d=Promise,m=Promise.prototype.then,h=Promise.resolve.bind(d),g=Promise.reject.bind(d);function w(e){return new d(e)}function S(e){return h(e)}function y(e){return g(e)}function x(e,n,o){return m.call(e,n,o)}function T(e,n,o){x(x(e,n,o),void 0,u)}function A(e,n){T(e,n)}function k(e,n){T(e,void 0,n)}function E(e,n,o){return x(e,n,o)}function O(e){x(e,void 0,u)}let _=(()=>{let e=s&&s.queueMicrotask;if(typeof e=="function")return e;let n=S(void 0);return o=>x(n,o)})();function I(e,n,o){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,n,o)}function P(e,n,o){try{return S(I(e,n,o))}catch(l){return y(l)}}let Re=16384;class Q{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(n){let o=this._back,l=o;o._elements.length===Re-1&&(l={_elements:[],_next:void 0}),o._elements.push(n),l!==o&&(this._back=l,o._next=l),++this._size}shift(){let n=this._front,o=n,l=this._cursor,f=l+1,p=n._elements,b=p[l];return f===Re&&(o=n._next,f=0),--this._size,this._cursor=f,n!==o&&(this._front=o),p[l]=void 0,b}forEach(n){let o=this._cursor,l=this._front,f=l._elements;for(;(o!==f.length||l._next!==void 0)&&!(o===f.length&&(l=l._next,f=l._elements,o=0,f.length===0));)n(f[o]),++o}peek(){let n=this._front,o=this._cursor;return n._elements[o]}}function Zt(e,n){e._ownerReadableStream=n,n._reader=e,n._state==="readable"?ke(e):n._state==="closed"?L(e):Pe(e,n._storedError)}function kt(e,n){let o=e._ownerReadableStream;return we(o,n)}function Y(e){e._ownerReadableStream._state==="readable"?be(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):en(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}function G(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function ke(e){e._closedPromise=w((n,o)=>{e._closedPromise_resolve=n,e._closedPromise_reject=o})}function Pe(e,n){ke(e),be(e,n)}function L(e){ke(e),Xt(e)}function be(e,n){e._closedPromise_reject!==void 0&&(O(e._closedPromise),e._closedPromise_reject(n),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function en(e,n){Pe(e,n)}function Xt(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let Kn=t("[[AbortSteps]]"),Qn=t("[[ErrorSteps]]"),tn=t("[[CancelSteps]]"),rn=t("[[PullSteps]]"),Zn=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},No=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function Wo(e){return typeof e=="object"||typeof e=="function"}function Oe(e,n){if(e!==void 0&&!Wo(e))throw new TypeError(`${n} is not an object.`)}function ye(e,n){if(typeof e!="function")throw new TypeError(`${n} is not a function.`)}function zo(e){return typeof e=="object"&&e!==null||typeof e=="function"}function Xn(e,n){if(!zo(e))throw new TypeError(`${n} is not an object.`)}function Ie(e,n,o){if(e===void 0)throw new TypeError(`Parameter ${n} is required in '${o}'.`)}function nn(e,n,o){if(e===void 0)throw new TypeError(`${n} is required in '${o}'.`)}function an(e){return Number(e)}function ea(e){return e===0?0:e}function jo(e){return ea(No(e))}function ta(e,n){let l=Number.MAX_SAFE_INTEGER,f=Number(e);if(f=ea(f),!Zn(f))throw new TypeError(`${n} is not a finite number`);if(f=jo(f),f<0||f>l)throw new TypeError(`${n} is outside the accepted range of 0 to ${l}, inclusive`);return!Zn(f)||f===0?0:f}function on(e,n){if(!qe(e))throw new TypeError(`${n} is not a ReadableStream.`)}function ut(e){return new Et(e)}function ra(e,n){e._reader._readRequests.push(n)}function sn(e,n,o){let f=e._reader._readRequests.shift();o?f._closeSteps():f._chunkSteps(n)}function er(e){return e._reader._readRequests.length}function na(e){let n=e._reader;return!(n===void 0||!Ne(n))}class Et{constructor(n){if(Ie(n,1,"ReadableStreamDefaultReader"),on(n,"First parameter"),Ve(n))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Zt(this,n),this._readRequests=new Q}get closed(){return Ne(this)?this._closedPromise:y(tr("closed"))}cancel(n=void 0){return Ne(this)?this._ownerReadableStream===void 0?y(G("cancel")):kt(this,n):y(tr("cancel"))}read(){if(!Ne(this))return y(tr("read"));if(this._ownerReadableStream===void 0)return y(G("read from"));let n,o,l=w((p,b)=>{n=p,o=b});return Tt(this,{_chunkSteps:p=>n({value:p,done:!1}),_closeSteps:()=>n({value:void 0,done:!0}),_errorSteps:p=>o(p)}),l}releaseLock(){if(!Ne(this))throw tr("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Y(this)}}}Object.defineProperties(Et.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Et.prototype,t.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Ne(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof Et}function Tt(e,n){let o=e._ownerReadableStream;o._disturbed=!0,o._state==="closed"?n._closeSteps():o._state==="errored"?n._errorSteps(o._storedError):o._readableStreamController[rn](n)}function tr(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}let aa=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class ia{constructor(n,o){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=n,this._preventCancel=o}next(){let n=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?E(this._ongoingPromise,n,n):n(),this._ongoingPromise}return(n){let o=()=>this._returnSteps(n);return this._ongoingPromise?E(this._ongoingPromise,o,o):o()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let n=this._reader;if(n._ownerReadableStream===void 0)return y(G("iterate"));let o,l,f=w((b,R)=>{o=b,l=R});return Tt(n,{_chunkSteps:b=>{this._ongoingPromise=void 0,_(()=>o({value:b,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,Y(n),o({value:void 0,done:!0})},_errorSteps:b=>{this._ongoingPromise=void 0,this._isFinished=!0,Y(n),l(b)}}),f}_returnSteps(n){if(this._isFinished)return Promise.resolve({value:n,done:!0});this._isFinished=!0;let o=this._reader;if(o._ownerReadableStream===void 0)return y(G("finish iterating"));if(!this._preventCancel){let l=kt(o,n);return Y(o),E(l,()=>({value:n,done:!0}))}return Y(o),S({value:n,done:!0})}}let oa={next(){return sa(this)?this._asyncIteratorImpl.next():y(ca("next"))},return(e){return sa(this)?this._asyncIteratorImpl.return(e):y(ca("return"))}};aa!==void 0&&Object.setPrototypeOf(oa,aa);function qo(e,n){let o=ut(e),l=new ia(o,n),f=Object.create(oa);return f._asyncIteratorImpl=l,f}function sa(e){if(!c(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof ia}catch{return!1}}function ca(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}let la=Number.isNaN||function(e){return e!==e};function vt(e){return e.slice()}function ua(e,n,o,l,f){new Uint8Array(e).set(new Uint8Array(o,l,f),n)}function gl(e){return e}function rr(e){return!1}function fa(e,n,o){if(e.slice)return e.slice(n,o);let l=o-n,f=new ArrayBuffer(l);return ua(f,0,e,n,l),f}function Vo(e){return!(typeof e!="number"||la(e)||e<0)}function da(e){let n=fa(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(n)}function cn(e){let n=e._queue.shift();return e._queueTotalSize-=n.size,e._queueTotalSize<0&&(e._queueTotalSize=0),n.value}function ln(e,n,o){if(!Vo(o)||o===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:n,size:o}),e._queueTotalSize+=o}function Ho(e){return e._queue.peek().value}function We(e){e._queue=new Q,e._queueTotalSize=0}class At{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!un(this))throw hn("view");return this._view}respond(n){if(!un(this))throw hn("respond");if(Ie(n,1,"respond"),n=ta(n,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");rr(this._view.buffer),sr(this._associatedReadableByteStreamController,n)}respondWithNewView(n){if(!un(this))throw hn("respondWithNewView");if(Ie(n,1,"respondWithNewView"),!ArrayBuffer.isView(n))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");rr(n.buffer),cr(this._associatedReadableByteStreamController,n)}}Object.defineProperties(At.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(At.prototype,t.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class ft{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Je(this))throw Ct("byobRequest");return mn(this)}get desiredSize(){if(!Je(this))throw Ct("desiredSize");return wa(this)}close(){if(!Je(this))throw Ct("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let n=this._controlledReadableByteStream._state;if(n!=="readable")throw new TypeError(`The stream (in ${n} state) is not in the readable state and cannot be closed`);$t(this)}enqueue(n){if(!Je(this))throw Ct("enqueue");if(Ie(n,1,"enqueue"),!ArrayBuffer.isView(n))throw new TypeError("chunk must be an array buffer view");if(n.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(n.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let o=this._controlledReadableByteStream._state;if(o!=="readable")throw new TypeError(`The stream (in ${o} state) is not in the readable state and cannot be enqueued to`);or(this,n)}error(n=void 0){if(!Je(this))throw Ct("error");xe(this,n)}[tn](n){ma(this),We(this);let o=this._cancelAlgorithm(n);return ir(this),o}[rn](n){let o=this._controlledReadableByteStream;if(this._queueTotalSize>0){let f=this._queue.shift();this._queueTotalSize-=f.byteLength,ba(this);let p=new Uint8Array(f.buffer,f.byteOffset,f.byteLength);n._chunkSteps(p);return}let l=this._autoAllocateChunkSize;if(l!==void 0){let f;try{f=new ArrayBuffer(l)}catch(b){n._errorSteps(b);return}let p={buffer:f,bufferByteLength:l,byteOffset:0,byteLength:l,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(p)}ra(o,n),Ye(this)}}Object.defineProperties(ft.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(ft.prototype,t.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Je(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof ft}function un(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof At}function Ye(e){if(!Ko(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let o=e._pullAlgorithm();T(o,()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Ye(e))},l=>{xe(e,l)})}function ma(e){dn(e),e._pendingPullIntos=new Q}function fn(e,n){let o=!1;e._state==="closed"&&(o=!0);let l=ha(n);n.readerType==="default"?sn(e,l,o):Xo(e,l,o)}function ha(e){let n=e.bytesFilled,o=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,n/o)}function nr(e,n,o,l){e._queue.push({buffer:n,byteOffset:o,byteLength:l}),e._queueTotalSize+=l}function pa(e,n){let o=n.elementSize,l=n.bytesFilled-n.bytesFilled%o,f=Math.min(e._queueTotalSize,n.byteLength-n.bytesFilled),p=n.bytesFilled+f,b=p-p%o,R=f,$=!1;b>l&&(R=b-n.bytesFilled,$=!0);let F=e._queue;for(;R>0;){let M=F.peek(),U=Math.min(R,M.byteLength),J=n.byteOffset+n.bytesFilled;ua(n.buffer,J,M.buffer,M.byteOffset,U),M.byteLength===U?F.shift():(M.byteOffset+=U,M.byteLength-=U),e._queueTotalSize-=U,ga(e,U,n),R-=U}return $}function ga(e,n,o){o.bytesFilled+=n}function ba(e){e._queueTotalSize===0&&e._closeRequested?(ir(e),Ut(e._controlledReadableByteStream)):Ye(e)}function dn(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function ya(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;let n=e._pendingPullIntos.peek();pa(e,n)&&(ar(e),fn(e._controlledReadableByteStream,n))}}function Go(e,n,o){let l=e._controlledReadableByteStream,f=1;n.constructor!==DataView&&(f=n.constructor.BYTES_PER_ELEMENT);let p=n.constructor,b=n.buffer,R={buffer:b,bufferByteLength:b.byteLength,byteOffset:n.byteOffset,byteLength:n.byteLength,bytesFilled:0,elementSize:f,viewConstructor:p,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(R),Ra(l,o);return}if(l._state==="closed"){let $=new p(R.buffer,R.byteOffset,0);o._closeSteps($);return}if(e._queueTotalSize>0){if(pa(e,R)){let $=ha(R);ba(e),o._chunkSteps($);return}if(e._closeRequested){let $=new TypeError("Insufficient bytes to fill elements in the given buffer");xe(e,$),o._errorSteps($);return}}e._pendingPullIntos.push(R),Ra(l,o),Ye(e)}function Jo(e,n){let o=e._controlledReadableByteStream;if(pn(o))for(;ka(o)>0;){let l=ar(e);fn(o,l)}}function Yo(e,n,o){if(ga(e,n,o),o.bytesFilled<o.elementSize)return;ar(e);let l=o.bytesFilled%o.elementSize;if(l>0){let f=o.byteOffset+o.bytesFilled,p=fa(o.buffer,f-l,f);nr(e,p,0,p.byteLength)}o.bytesFilled-=l,fn(e._controlledReadableByteStream,o),ya(e)}function xa(e,n){let o=e._pendingPullIntos.peek();dn(e),e._controlledReadableByteStream._state==="closed"?Jo(e):Yo(e,n,o),Ye(e)}function ar(e){return e._pendingPullIntos.shift()}function Ko(e){let n=e._controlledReadableByteStream;return n._state!=="readable"||e._closeRequested||!e._started?!1:!!(na(n)&&er(n)>0||pn(n)&&ka(n)>0||wa(e)>0)}function ir(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function $t(e){let n=e._controlledReadableByteStream;if(!(e._closeRequested||n._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0&&e._pendingPullIntos.peek().bytesFilled>0){let l=new TypeError("Insufficient bytes to fill elements in the given buffer");throw xe(e,l),l}ir(e),Ut(n)}}function or(e,n){let o=e._controlledReadableByteStream;if(e._closeRequested||o._state!=="readable")return;let l=n.buffer,f=n.byteOffset,p=n.byteLength,b=l;if(e._pendingPullIntos.length>0){let R=e._pendingPullIntos.peek();rr(R.buffer),R.buffer=R.buffer}if(dn(e),na(o))if(er(o)===0)nr(e,b,f,p);else{e._pendingPullIntos.length>0&&ar(e);let R=new Uint8Array(b,f,p);sn(o,R,!1)}else pn(o)?(nr(e,b,f,p),ya(e)):nr(e,b,f,p);Ye(e)}function xe(e,n){let o=e._controlledReadableByteStream;o._state==="readable"&&(ma(e),We(e),ir(e),Ja(o,n))}function mn(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){let n=e._pendingPullIntos.peek(),o=new Uint8Array(n.buffer,n.byteOffset+n.bytesFilled,n.byteLength-n.bytesFilled),l=Object.create(At.prototype);Zo(l,e,o),e._byobRequest=l}return e._byobRequest}function wa(e){let n=e._controlledReadableByteStream._state;return n==="errored"?null:n==="closed"?0:e._strategyHWM-e._queueTotalSize}function sr(e,n){let o=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(n!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(n===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(o.bytesFilled+n>o.byteLength)throw new RangeError("bytesWritten out of range")}o.buffer=o.buffer,xa(e,n)}function cr(e,n){let o=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(n.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(n.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(o.byteOffset+o.bytesFilled!==n.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(o.bufferByteLength!==n.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(o.bytesFilled+n.byteLength>o.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let f=n.byteLength;o.buffer=n.buffer,xa(e,f)}function Sa(e,n,o,l,f,p,b){n._controlledReadableByteStream=e,n._pullAgain=!1,n._pulling=!1,n._byobRequest=null,n._queue=n._queueTotalSize=void 0,We(n),n._closeRequested=!1,n._started=!1,n._strategyHWM=p,n._pullAlgorithm=l,n._cancelAlgorithm=f,n._autoAllocateChunkSize=b,n._pendingPullIntos=new Q,e._readableStreamController=n;let R=o();T(S(R),()=>{n._started=!0,Ye(n)},$=>{xe(n,$)})}function Qo(e,n,o){let l=Object.create(ft.prototype),f=()=>{},p=()=>S(void 0),b=()=>S(void 0);n.start!==void 0&&(f=()=>n.start(l)),n.pull!==void 0&&(p=()=>n.pull(l)),n.cancel!==void 0&&(b=$=>n.cancel($));let R=n.autoAllocateChunkSize;if(R===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Sa(e,l,f,p,b,o,R)}function Zo(e,n,o){e._associatedReadableByteStreamController=n,e._view=o}function hn(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function Ct(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function _a(e){return new Pt(e)}function Ra(e,n){e._reader._readIntoRequests.push(n)}function Xo(e,n,o){let f=e._reader._readIntoRequests.shift();o?f._closeSteps(n):f._chunkSteps(n)}function ka(e){return e._reader._readIntoRequests.length}function pn(e){let n=e._reader;return!(n===void 0||!Ke(n))}class Pt{constructor(n){if(Ie(n,1,"ReadableStreamBYOBReader"),on(n,"First parameter"),Ve(n))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Je(n._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Zt(this,n),this._readIntoRequests=new Q}get closed(){return Ke(this)?this._closedPromise:y(lr("closed"))}cancel(n=void 0){return Ke(this)?this._ownerReadableStream===void 0?y(G("cancel")):kt(this,n):y(lr("cancel"))}read(n){if(!Ke(this))return y(lr("read"));if(!ArrayBuffer.isView(n))return y(new TypeError("view must be an array buffer view"));if(n.byteLength===0)return y(new TypeError("view must have non-zero byteLength"));if(n.buffer.byteLength===0)return y(new TypeError("view's buffer must have non-zero byteLength"));if(rr(n.buffer),this._ownerReadableStream===void 0)return y(G("read from"));let o,l,f=w((b,R)=>{o=b,l=R});return Ea(this,n,{_chunkSteps:b=>o({value:b,done:!1}),_closeSteps:b=>o({value:b,done:!0}),_errorSteps:b=>l(b)}),f}releaseLock(){if(!Ke(this))throw lr("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Y(this)}}}Object.defineProperties(Pt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Pt.prototype,t.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Ke(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof Pt}function Ea(e,n,o){let l=e._ownerReadableStream;l._disturbed=!0,l._state==="errored"?o._errorSteps(l._storedError):Go(l._readableStreamController,n,o)}function lr(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function Ot(e,n){let{highWaterMark:o}=e;if(o===void 0)return n;if(la(o)||o<0)throw new RangeError("Invalid highWaterMark");return o}function ur(e){let{size:n}=e;return n||(()=>1)}function fr(e,n){Oe(e,n);let o=e?.highWaterMark,l=e?.size;return{highWaterMark:o===void 0?void 0:an(o),size:l===void 0?void 0:es(l,`${n} has member 'size' that`)}}function es(e,n){return ye(e,n),o=>an(e(o))}function ts(e,n){Oe(e,n);let o=e?.abort,l=e?.close,f=e?.start,p=e?.type,b=e?.write;return{abort:o===void 0?void 0:rs(o,e,`${n} has member 'abort' that`),close:l===void 0?void 0:ns(l,e,`${n} has member 'close' that`),start:f===void 0?void 0:as(f,e,`${n} has member 'start' that`),write:b===void 0?void 0:is(b,e,`${n} has member 'write' that`),type:p}}function rs(e,n,o){return ye(e,o),l=>P(e,n,[l])}function ns(e,n,o){return ye(e,o),()=>P(e,n,[])}function as(e,n,o){return ye(e,o),l=>I(e,n,[l])}function is(e,n,o){return ye(e,o),(l,f)=>P(e,n,[l,f])}function Ta(e,n){if(!dt(e))throw new TypeError(`${n} is not a WritableStream.`)}function os(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}let ss=typeof AbortController=="function";function cs(){if(ss)return new AbortController}class It{constructor(n={},o={}){n===void 0?n=null:Xn(n,"First parameter");let l=fr(o,"Second parameter"),f=ts(n,"First parameter");if(Aa(this),f.type!==void 0)throw new RangeError("Invalid type is specified");let b=ur(l),R=Ot(l,1);_s(this,f,R,b)}get locked(){if(!dt(this))throw gr("locked");return mt(this)}abort(n=void 0){return dt(this)?mt(this)?y(new TypeError("Cannot abort a stream that already has a writer")):dr(this,n):y(gr("abort"))}close(){return dt(this)?mt(this)?y(new TypeError("Cannot close a stream that already has a writer")):Ee(this)?y(new TypeError("Cannot close an already-closing stream")):$a(this):y(gr("close"))}getWriter(){if(!dt(this))throw gr("getWriter");return va(this)}}Object.defineProperties(It.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(It.prototype,t.toStringTag,{value:"WritableStream",configurable:!0});function va(e){return new Bt(e)}function ls(e,n,o,l,f=1,p=()=>1){let b=Object.create(It.prototype);Aa(b);let R=Object.create(ht.prototype);return Fa(b,R,e,n,o,l,f,p),b}function Aa(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new Q,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function dt(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof It}function mt(e){return e._writer!==void 0}function dr(e,n){var o;if(e._state==="closed"||e._state==="errored")return S(void 0);e._writableStreamController._abortReason=n,(o=e._writableStreamController._abortController)===null||o===void 0||o.abort();let l=e._state;if(l==="closed"||l==="errored")return S(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let f=!1;l==="erroring"&&(f=!0,n=void 0);let p=w((b,R)=>{e._pendingAbortRequest={_promise:void 0,_resolve:b,_reject:R,_reason:n,_wasAlreadyErroring:f}});return e._pendingAbortRequest._promise=p,f||bn(e,n),p}function $a(e){let n=e._state;if(n==="closed"||n==="errored")return y(new TypeError(`The stream (in ${n} state) is not in the writable state and cannot be closed`));let o=w((f,p)=>{let b={_resolve:f,_reject:p};e._closeRequest=b}),l=e._writer;return l!==void 0&&e._backpressure&&n==="writable"&&Tn(l),Rs(e._writableStreamController),o}function us(e){return w((o,l)=>{let f={_resolve:o,_reject:l};e._writeRequests.push(f)})}function gn(e,n){if(e._state==="writable"){bn(e,n);return}yn(e)}function bn(e,n){let o=e._writableStreamController;e._state="erroring",e._storedError=n;let l=e._writer;l!==void 0&&Pa(l,n),!ps(e)&&o._started&&yn(e)}function yn(e){e._state="errored",e._writableStreamController[Qn]();let n=e._storedError;if(e._writeRequests.forEach(f=>{f._reject(n)}),e._writeRequests=new Q,e._pendingAbortRequest===void 0){mr(e);return}let o=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,o._wasAlreadyErroring){o._reject(n),mr(e);return}let l=e._writableStreamController[Kn](o._reason);T(l,()=>{o._resolve(),mr(e)},f=>{o._reject(f),mr(e)})}function fs(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function ds(e,n){e._inFlightWriteRequest._reject(n),e._inFlightWriteRequest=void 0,gn(e,n)}function ms(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let o=e._writer;o!==void 0&&La(o)}function hs(e,n){e._inFlightCloseRequest._reject(n),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(n),e._pendingAbortRequest=void 0),gn(e,n)}function Ee(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function ps(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function gs(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function bs(e){e._inFlightWriteRequest=e._writeRequests.shift()}function mr(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let n=e._writer;n!==void 0&&kn(n,e._storedError)}function xn(e,n){let o=e._writer;o!==void 0&&n!==e._backpressure&&(n?Cs(o):Tn(o)),e._backpressure=n}class Bt{constructor(n){if(Ie(n,1,"WritableStreamDefaultWriter"),Ta(n,"First parameter"),mt(n))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=n,n._writer=this;let o=n._state;if(o==="writable")!Ee(n)&&n._backpressure?yr(this):Na(this),br(this);else if(o==="erroring")En(this,n._storedError),br(this);else if(o==="closed")Na(this),As(this);else{let l=n._storedError;En(this,l),Ua(this,l)}}get closed(){return Qe(this)?this._closedPromise:y(Ze("closed"))}get desiredSize(){if(!Qe(this))throw Ze("desiredSize");if(this._ownerWritableStream===void 0)throw Ft("desiredSize");return Ss(this)}get ready(){return Qe(this)?this._readyPromise:y(Ze("ready"))}abort(n=void 0){return Qe(this)?this._ownerWritableStream===void 0?y(Ft("abort")):ys(this,n):y(Ze("abort"))}close(){if(!Qe(this))return y(Ze("close"));let n=this._ownerWritableStream;return n===void 0?y(Ft("close")):Ee(n)?y(new TypeError("Cannot close an already-closing stream")):Ca(this)}releaseLock(){if(!Qe(this))throw Ze("releaseLock");this._ownerWritableStream!==void 0&&Oa(this)}write(n=void 0){return Qe(this)?this._ownerWritableStream===void 0?y(Ft("write to")):Ia(this,n):y(Ze("write"))}}Object.defineProperties(Bt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Bt.prototype,t.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Qe(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof Bt}function ys(e,n){let o=e._ownerWritableStream;return dr(o,n)}function Ca(e){let n=e._ownerWritableStream;return $a(n)}function xs(e){let n=e._ownerWritableStream,o=n._state;return Ee(n)||o==="closed"?S(void 0):o==="errored"?y(n._storedError):Ca(e)}function ws(e,n){e._closedPromiseState==="pending"?kn(e,n):$s(e,n)}function Pa(e,n){e._readyPromiseState==="pending"?Wa(e,n):Ps(e,n)}function Ss(e){let n=e._ownerWritableStream,o=n._state;return o==="errored"||o==="erroring"?null:o==="closed"?0:Da(n._writableStreamController)}function Oa(e){let n=e._ownerWritableStream,o=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Pa(e,o),ws(e,o),n._writer=void 0,e._ownerWritableStream=void 0}function Ia(e,n){let o=e._ownerWritableStream,l=o._writableStreamController,f=ks(l,n);if(o!==e._ownerWritableStream)return y(Ft("write to"));let p=o._state;if(p==="errored")return y(o._storedError);if(Ee(o)||p==="closed")return y(new TypeError("The stream is closing or closed and cannot be written to"));if(p==="erroring")return y(o._storedError);let b=us(o);return Es(l,n,f),b}let Ba={};class ht{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!wn(this))throw Rn("abortReason");return this._abortReason}get signal(){if(!wn(this))throw Rn("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(n=void 0){if(!wn(this))throw Rn("error");this._controlledWritableStream._state==="writable"&&Ma(this,n)}[Kn](n){let o=this._abortAlgorithm(n);return hr(this),o}[Qn](){We(this)}}Object.defineProperties(ht.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(ht.prototype,t.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function wn(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof ht}function Fa(e,n,o,l,f,p,b,R){n._controlledWritableStream=e,e._writableStreamController=n,n._queue=void 0,n._queueTotalSize=void 0,We(n),n._abortReason=void 0,n._abortController=cs(),n._started=!1,n._strategySizeAlgorithm=R,n._strategyHWM=b,n._writeAlgorithm=l,n._closeAlgorithm=f,n._abortAlgorithm=p;let $=_n(n);xn(e,$);let F=o(),M=S(F);T(M,()=>{n._started=!0,pr(n)},U=>{n._started=!0,gn(e,U)})}function _s(e,n,o,l){let f=Object.create(ht.prototype),p=()=>{},b=()=>S(void 0),R=()=>S(void 0),$=()=>S(void 0);n.start!==void 0&&(p=()=>n.start(f)),n.write!==void 0&&(b=F=>n.write(F,f)),n.close!==void 0&&(R=()=>n.close()),n.abort!==void 0&&($=F=>n.abort(F)),Fa(e,f,p,b,R,$,o,l)}function hr(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Rs(e){ln(e,Ba,0),pr(e)}function ks(e,n){try{return e._strategySizeAlgorithm(n)}catch(o){return Sn(e,o),1}}function Da(e){return e._strategyHWM-e._queueTotalSize}function Es(e,n,o){try{ln(e,n,o)}catch(f){Sn(e,f);return}let l=e._controlledWritableStream;if(!Ee(l)&&l._state==="writable"){let f=_n(e);xn(l,f)}pr(e)}function pr(e){let n=e._controlledWritableStream;if(!e._started||n._inFlightWriteRequest!==void 0)return;if(n._state==="erroring"){yn(n);return}if(e._queue.length===0)return;let l=Ho(e);l===Ba?Ts(e):vs(e,l)}function Sn(e,n){e._controlledWritableStream._state==="writable"&&Ma(e,n)}function Ts(e){let n=e._controlledWritableStream;gs(n),cn(e);let o=e._closeAlgorithm();hr(e),T(o,()=>{ms(n)},l=>{hs(n,l)})}function vs(e,n){let o=e._controlledWritableStream;bs(o);let l=e._writeAlgorithm(n);T(l,()=>{fs(o);let f=o._state;if(cn(e),!Ee(o)&&f==="writable"){let p=_n(e);xn(o,p)}pr(e)},f=>{o._state==="writable"&&hr(e),ds(o,f)})}function _n(e){return Da(e)<=0}function Ma(e,n){let o=e._controlledWritableStream;hr(e),bn(o,n)}function gr(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function Rn(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function Ze(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function Ft(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function br(e){e._closedPromise=w((n,o)=>{e._closedPromise_resolve=n,e._closedPromise_reject=o,e._closedPromiseState="pending"})}function Ua(e,n){br(e),kn(e,n)}function As(e){br(e),La(e)}function kn(e,n){e._closedPromise_reject!==void 0&&(O(e._closedPromise),e._closedPromise_reject(n),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function $s(e,n){Ua(e,n)}function La(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function yr(e){e._readyPromise=w((n,o)=>{e._readyPromise_resolve=n,e._readyPromise_reject=o}),e._readyPromiseState="pending"}function En(e,n){yr(e),Wa(e,n)}function Na(e){yr(e),Tn(e)}function Wa(e,n){e._readyPromise_reject!==void 0&&(O(e._readyPromise),e._readyPromise_reject(n),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function Cs(e){yr(e)}function Ps(e,n){En(e,n)}function Tn(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}let za=typeof DOMException<"u"?DOMException:void 0;function Os(e){if(!(typeof e=="function"||typeof e=="object"))return!1;try{return new e,!0}catch{return!1}}function Is(){let e=function(o,l){this.message=o||"",this.name=l||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}let Bs=Os(za)?za:Is();function ja(e,n,o,l,f,p){let b=ut(e),R=va(n);e._disturbed=!0;let $=!1,F=S(void 0);return w((M,U)=>{let J;if(p!==void 0){if(J=()=>{let v=new Bs("Aborted","AbortError"),B=[];l||B.push(()=>n._state==="writable"?dr(n,v):S(void 0)),f||B.push(()=>e._state==="readable"?we(e,v):S(void 0)),re(()=>Promise.all(B.map(q=>q())),!0,v)},p.aborted){J();return}p.addEventListener("abort",J)}function Se(){return w((v,B)=>{function q(oe){oe?v():x(bt(),q,B)}q(!1)})}function bt(){return $?S(!0):x(R._readyPromise,()=>w((v,B)=>{Tt(b,{_chunkSteps:q=>{F=x(Ia(R,q),void 0,r),v(!1)},_closeSteps:()=>v(!0),_errorSteps:B})}))}if(Be(e,b._closedPromise,v=>{l?de(!0,v):re(()=>dr(n,v),!0,v)}),Be(n,R._closedPromise,v=>{f?de(!0,v):re(()=>we(e,v),!0,v)}),Z(e,b._closedPromise,()=>{o?de():re(()=>xs(R))}),Ee(n)||n._state==="closed"){let v=new TypeError("the destination writable stream closed before all data could be piped to it");f?de(!0,v):re(()=>we(e,v),!0,v)}O(Se());function He(){let v=F;return x(F,()=>v!==F?He():void 0)}function Be(v,B,q){v._state==="errored"?q(v._storedError):k(B,q)}function Z(v,B,q){v._state==="closed"?q():A(B,q)}function re(v,B,q){if($)return;$=!0,n._state==="writable"&&!Ee(n)?A(He(),oe):oe();function oe(){T(v(),()=>Fe(B,q),yt=>Fe(!0,yt))}}function de(v,B){$||($=!0,n._state==="writable"&&!Ee(n)?A(He(),()=>Fe(v,B)):Fe(v,B))}function Fe(v,B){Oa(R),Y(b),p!==void 0&&p.removeEventListener("abort",J),v?U(B):M(void 0)}})}class pt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!xr(this))throw _r("desiredSize");return vn(this)}close(){if(!xr(this))throw _r("close");if(!gt(this))throw new TypeError("The stream is not in a state that permits close");Mt(this)}enqueue(n=void 0){if(!xr(this))throw _r("enqueue");if(!gt(this))throw new TypeError("The stream is not in a state that permits enqueue");return Sr(this,n)}error(n=void 0){if(!xr(this))throw _r("error");ze(this,n)}[tn](n){We(this);let o=this._cancelAlgorithm(n);return wr(this),o}[rn](n){let o=this._controlledReadableStream;if(this._queue.length>0){let l=cn(this);this._closeRequested&&this._queue.length===0?(wr(this),Ut(o)):Dt(this),n._chunkSteps(l)}else ra(o,n),Dt(this)}}Object.defineProperties(pt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(pt.prototype,t.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function xr(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof pt}function Dt(e){if(!qa(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let o=e._pullAlgorithm();T(o,()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Dt(e))},l=>{ze(e,l)})}function qa(e){let n=e._controlledReadableStream;return!gt(e)||!e._started?!1:!!(Ve(n)&&er(n)>0||vn(e)>0)}function wr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Mt(e){if(!gt(e))return;let n=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(wr(e),Ut(n))}function Sr(e,n){if(!gt(e))return;let o=e._controlledReadableStream;if(Ve(o)&&er(o)>0)sn(o,n,!1);else{let l;try{l=e._strategySizeAlgorithm(n)}catch(f){throw ze(e,f),f}try{ln(e,n,l)}catch(f){throw ze(e,f),f}}Dt(e)}function ze(e,n){let o=e._controlledReadableStream;o._state==="readable"&&(We(e),wr(e),Ja(o,n))}function vn(e){let n=e._controlledReadableStream._state;return n==="errored"?null:n==="closed"?0:e._strategyHWM-e._queueTotalSize}function Fs(e){return!qa(e)}function gt(e){let n=e._controlledReadableStream._state;return!e._closeRequested&&n==="readable"}function Va(e,n,o,l,f,p,b){n._controlledReadableStream=e,n._queue=void 0,n._queueTotalSize=void 0,We(n),n._started=!1,n._closeRequested=!1,n._pullAgain=!1,n._pulling=!1,n._strategySizeAlgorithm=b,n._strategyHWM=p,n._pullAlgorithm=l,n._cancelAlgorithm=f,e._readableStreamController=n;let R=o();T(S(R),()=>{n._started=!0,Dt(n)},$=>{ze(n,$)})}function Ds(e,n,o,l){let f=Object.create(pt.prototype),p=()=>{},b=()=>S(void 0),R=()=>S(void 0);n.start!==void 0&&(p=()=>n.start(f)),n.pull!==void 0&&(b=()=>n.pull(f)),n.cancel!==void 0&&(R=$=>n.cancel($)),Va(e,f,p,b,R,o,l)}function _r(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function Ms(e,n){return Je(e._readableStreamController)?Ls(e):Us(e)}function Us(e,n){let o=ut(e),l=!1,f=!1,p=!1,b=!1,R,$,F,M,U,J=w(Z=>{U=Z});function Se(){return l?(f=!0,S(void 0)):(l=!0,Tt(o,{_chunkSteps:re=>{_(()=>{f=!1;let de=re,Fe=re;p||Sr(F._readableStreamController,de),b||Sr(M._readableStreamController,Fe),l=!1,f&&Se()})},_closeSteps:()=>{l=!1,p||Mt(F._readableStreamController),b||Mt(M._readableStreamController),(!p||!b)&&U(void 0)},_errorSteps:()=>{l=!1}}),S(void 0))}function bt(Z){if(p=!0,R=Z,b){let re=vt([R,$]),de=we(e,re);U(de)}return J}function He(Z){if(b=!0,$=Z,p){let re=vt([R,$]),de=we(e,re);U(de)}return J}function Be(){}return F=An(Be,Se,bt),M=An(Be,Se,He),k(o._closedPromise,Z=>{ze(F._readableStreamController,Z),ze(M._readableStreamController,Z),(!p||!b)&&U(void 0)}),[F,M]}function Ls(e){let n=ut(e),o=!1,l=!1,f=!1,p=!1,b=!1,R,$,F,M,U,J=w(v=>{U=v});function Se(v){k(v._closedPromise,B=>{v===n&&(xe(F._readableStreamController,B),xe(M._readableStreamController,B),(!p||!b)&&U(void 0))})}function bt(){Ke(n)&&(Y(n),n=ut(e),Se(n)),Tt(n,{_chunkSteps:B=>{_(()=>{l=!1,f=!1;let q=B,oe=B;if(!p&&!b)try{oe=da(B)}catch(yt){xe(F._readableStreamController,yt),xe(M._readableStreamController,yt),U(we(e,yt));return}p||or(F._readableStreamController,q),b||or(M._readableStreamController,oe),o=!1,l?Be():f&&Z()})},_closeSteps:()=>{o=!1,p||$t(F._readableStreamController),b||$t(M._readableStreamController),F._readableStreamController._pendingPullIntos.length>0&&sr(F._readableStreamController,0),M._readableStreamController._pendingPullIntos.length>0&&sr(M._readableStreamController,0),(!p||!b)&&U(void 0)},_errorSteps:()=>{o=!1}})}function He(v,B){Ne(n)&&(Y(n),n=_a(e),Se(n));let q=B?M:F,oe=B?F:M;Ea(n,v,{_chunkSteps:xt=>{_(()=>{l=!1,f=!1;let wt=B?b:p;if(B?p:b)wt||cr(q._readableStreamController,xt);else{let si;try{si=da(xt)}catch(Cn){xe(q._readableStreamController,Cn),xe(oe._readableStreamController,Cn),U(we(e,Cn));return}wt||cr(q._readableStreamController,xt),or(oe._readableStreamController,si)}o=!1,l?Be():f&&Z()})},_closeSteps:xt=>{o=!1;let wt=B?b:p,Pr=B?p:b;wt||$t(q._readableStreamController),Pr||$t(oe._readableStreamController),xt!==void 0&&(wt||cr(q._readableStreamController,xt),!Pr&&oe._readableStreamController._pendingPullIntos.length>0&&sr(oe._readableStreamController,0)),(!wt||!Pr)&&U(void 0)},_errorSteps:()=>{o=!1}})}function Be(){if(o)return l=!0,S(void 0);o=!0;let v=mn(F._readableStreamController);return v===null?bt():He(v._view,!1),S(void 0)}function Z(){if(o)return f=!0,S(void 0);o=!0;let v=mn(M._readableStreamController);return v===null?bt():He(v._view,!0),S(void 0)}function re(v){if(p=!0,R=v,b){let B=vt([R,$]),q=we(e,B);U(q)}return J}function de(v){if(b=!0,$=v,p){let B=vt([R,$]),q=we(e,B);U(q)}return J}function Fe(){}return F=Ga(Fe,Be,re),M=Ga(Fe,Z,de),Se(n),[F,M]}function Ns(e,n){Oe(e,n);let o=e,l=o?.autoAllocateChunkSize,f=o?.cancel,p=o?.pull,b=o?.start,R=o?.type;return{autoAllocateChunkSize:l===void 0?void 0:ta(l,`${n} has member 'autoAllocateChunkSize' that`),cancel:f===void 0?void 0:Ws(f,o,`${n} has member 'cancel' that`),pull:p===void 0?void 0:zs(p,o,`${n} has member 'pull' that`),start:b===void 0?void 0:js(b,o,`${n} has member 'start' that`),type:R===void 0?void 0:qs(R,`${n} has member 'type' that`)}}function Ws(e,n,o){return ye(e,o),l=>P(e,n,[l])}function zs(e,n,o){return ye(e,o),l=>P(e,n,[l])}function js(e,n,o){return ye(e,o),l=>I(e,n,[l])}function qs(e,n){if(e=`${e}`,e!=="bytes")throw new TypeError(`${n} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function Vs(e,n){Oe(e,n);let o=e?.mode;return{mode:o===void 0?void 0:Hs(o,`${n} has member 'mode' that`)}}function Hs(e,n){if(e=`${e}`,e!=="byob")throw new TypeError(`${n} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function Gs(e,n){return Oe(e,n),{preventCancel:!!e?.preventCancel}}function Ha(e,n){Oe(e,n);let o=e?.preventAbort,l=e?.preventCancel,f=e?.preventClose,p=e?.signal;return p!==void 0&&Js(p,`${n} has member 'signal' that`),{preventAbort:!!o,preventCancel:!!l,preventClose:!!f,signal:p}}function Js(e,n){if(!os(e))throw new TypeError(`${n} is not an AbortSignal.`)}function Ys(e,n){Oe(e,n);let o=e?.readable;nn(o,"readable","ReadableWritablePair"),on(o,`${n} has member 'readable' that`);let l=e?.writable;return nn(l,"writable","ReadableWritablePair"),Ta(l,`${n} has member 'writable' that`),{readable:o,writable:l}}class je{constructor(n={},o={}){n===void 0?n=null:Xn(n,"First parameter");let l=fr(o,"Second parameter"),f=Ns(n,"First parameter");if($n(this),f.type==="bytes"){if(l.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let p=Ot(l,0);Qo(this,f,p)}else{let p=ur(l),b=Ot(l,1);Ds(this,f,b,p)}}get locked(){if(!qe(this))throw Xe("locked");return Ve(this)}cancel(n=void 0){return qe(this)?Ve(this)?y(new TypeError("Cannot cancel a stream that already has a reader")):we(this,n):y(Xe("cancel"))}getReader(n=void 0){if(!qe(this))throw Xe("getReader");return Vs(n,"First parameter").mode===void 0?ut(this):_a(this)}pipeThrough(n,o={}){if(!qe(this))throw Xe("pipeThrough");Ie(n,1,"pipeThrough");let l=Ys(n,"First parameter"),f=Ha(o,"Second parameter");if(Ve(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(mt(l.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let p=ja(this,l.writable,f.preventClose,f.preventAbort,f.preventCancel,f.signal);return O(p),l.readable}pipeTo(n,o={}){if(!qe(this))return y(Xe("pipeTo"));if(n===void 0)return y("Parameter 1 is required in 'pipeTo'.");if(!dt(n))return y(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let l;try{l=Ha(o,"Second parameter")}catch(f){return y(f)}return Ve(this)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):mt(n)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):ja(this,n,l.preventClose,l.preventAbort,l.preventCancel,l.signal)}tee(){if(!qe(this))throw Xe("tee");let n=Ms(this);return vt(n)}values(n=void 0){if(!qe(this))throw Xe("values");let o=Gs(n,"First parameter");return qo(this,o.preventCancel)}}Object.defineProperties(je.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(je.prototype,t.toStringTag,{value:"ReadableStream",configurable:!0}),typeof t.asyncIterator=="symbol"&&Object.defineProperty(je.prototype,t.asyncIterator,{value:je.prototype.values,writable:!0,configurable:!0});function An(e,n,o,l=1,f=()=>1){let p=Object.create(je.prototype);$n(p);let b=Object.create(pt.prototype);return Va(p,b,e,n,o,l,f),p}function Ga(e,n,o){let l=Object.create(je.prototype);$n(l);let f=Object.create(ft.prototype);return Sa(l,f,e,n,o,0,void 0),l}function $n(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function qe(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof je}function Ve(e){return e._reader!==void 0}function we(e,n){if(e._disturbed=!0,e._state==="closed")return S(void 0);if(e._state==="errored")return y(e._storedError);Ut(e);let o=e._reader;o!==void 0&&Ke(o)&&(o._readIntoRequests.forEach(f=>{f._closeSteps(void 0)}),o._readIntoRequests=new Q);let l=e._readableStreamController[tn](n);return E(l,r)}function Ut(e){e._state="closed";let n=e._reader;n!==void 0&&(Xt(n),Ne(n)&&(n._readRequests.forEach(o=>{o._closeSteps()}),n._readRequests=new Q))}function Ja(e,n){e._state="errored",e._storedError=n;let o=e._reader;o!==void 0&&(be(o,n),Ne(o)?(o._readRequests.forEach(l=>{l._errorSteps(n)}),o._readRequests=new Q):(o._readIntoRequests.forEach(l=>{l._errorSteps(n)}),o._readIntoRequests=new Q))}function Xe(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function Ya(e,n){Oe(e,n);let o=e?.highWaterMark;return nn(o,"highWaterMark","QueuingStrategyInit"),{highWaterMark:an(o)}}let Ka=e=>e.byteLength;try{Object.defineProperty(Ka,"name",{value:"size",configurable:!0})}catch{}class Rr{constructor(n){Ie(n,1,"ByteLengthQueuingStrategy"),n=Ya(n,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=n.highWaterMark}get highWaterMark(){if(!Za(this))throw Qa("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Za(this))throw Qa("size");return Ka}}Object.defineProperties(Rr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Rr.prototype,t.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Qa(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function Za(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof Rr}let Xa=()=>1;try{Object.defineProperty(Xa,"name",{value:"size",configurable:!0})}catch{}class kr{constructor(n){Ie(n,1,"CountQueuingStrategy"),n=Ya(n,"First parameter"),this._countQueuingStrategyHighWaterMark=n.highWaterMark}get highWaterMark(){if(!ti(this))throw ei("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!ti(this))throw ei("size");return Xa}}Object.defineProperties(kr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(kr.prototype,t.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function ei(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function ti(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof kr}function Ks(e,n){Oe(e,n);let o=e?.flush,l=e?.readableType,f=e?.start,p=e?.transform,b=e?.writableType;return{flush:o===void 0?void 0:Qs(o,e,`${n} has member 'flush' that`),readableType:l,start:f===void 0?void 0:Zs(f,e,`${n} has member 'start' that`),transform:p===void 0?void 0:Xs(p,e,`${n} has member 'transform' that`),writableType:b}}function Qs(e,n,o){return ye(e,o),l=>P(e,n,[l])}function Zs(e,n,o){return ye(e,o),l=>I(e,n,[l])}function Xs(e,n,o){return ye(e,o),(l,f)=>P(e,n,[l,f])}class Er{constructor(n={},o={},l={}){n===void 0&&(n=null);let f=fr(o,"Second parameter"),p=fr(l,"Third parameter"),b=Ks(n,"First parameter");if(b.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(b.writableType!==void 0)throw new RangeError("Invalid writableType specified");let R=Ot(p,0),$=ur(p),F=Ot(f,1),M=ur(f),U,J=w(Se=>{U=Se});ec(this,J,F,M,R,$),rc(this,b),b.start!==void 0?U(b.start(this._transformStreamController)):U(void 0)}get readable(){if(!ri(this))throw oi("readable");return this._readable}get writable(){if(!ri(this))throw oi("writable");return this._writable}}Object.defineProperties(Er.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Er.prototype,t.toStringTag,{value:"TransformStream",configurable:!0});function ec(e,n,o,l,f,p){function b(){return n}function R(J){return ic(e,J)}function $(J){return oc(e,J)}function F(){return sc(e)}e._writable=ls(b,R,F,$,o,l);function M(){return cc(e)}function U(J){return vr(e,J),S(void 0)}e._readable=An(b,M,U,f,p),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,Ar(e,!0),e._transformStreamController=void 0}function ri(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof Er}function Tr(e,n){ze(e._readable._readableStreamController,n),vr(e,n)}function vr(e,n){ni(e._transformStreamController),Sn(e._writable._writableStreamController,n),e._backpressure&&Ar(e,!1)}function Ar(e,n){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=w(o=>{e._backpressureChangePromise_resolve=o}),e._backpressure=n}class Lt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!$r(this))throw Cr("desiredSize");let n=this._controlledTransformStream._readable._readableStreamController;return vn(n)}enqueue(n=void 0){if(!$r(this))throw Cr("enqueue");ai(this,n)}error(n=void 0){if(!$r(this))throw Cr("error");nc(this,n)}terminate(){if(!$r(this))throw Cr("terminate");ac(this)}}Object.defineProperties(Lt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Lt.prototype,t.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function $r(e){return!c(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof Lt}function tc(e,n,o,l){n._controlledTransformStream=e,e._transformStreamController=n,n._transformAlgorithm=o,n._flushAlgorithm=l}function rc(e,n){let o=Object.create(Lt.prototype),l=p=>{try{return ai(o,p),S(void 0)}catch(b){return y(b)}},f=()=>S(void 0);n.transform!==void 0&&(l=p=>n.transform(p,o)),n.flush!==void 0&&(f=()=>n.flush(o)),tc(e,o,l,f)}function ni(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function ai(e,n){let o=e._controlledTransformStream,l=o._readable._readableStreamController;if(!gt(l))throw new TypeError("Readable side is not in a state that permits enqueue");try{Sr(l,n)}catch(p){throw vr(o,p),o._readable._storedError}Fs(l)!==o._backpressure&&Ar(o,!0)}function nc(e,n){Tr(e._controlledTransformStream,n)}function ii(e,n){let o=e._transformAlgorithm(n);return E(o,void 0,l=>{throw Tr(e._controlledTransformStream,l),l})}function ac(e){let n=e._controlledTransformStream,o=n._readable._readableStreamController;Mt(o);let l=new TypeError("TransformStream terminated");vr(n,l)}function ic(e,n){let o=e._transformStreamController;if(e._backpressure){let l=e._backpressureChangePromise;return E(l,()=>{let f=e._writable;if(f._state==="erroring")throw f._storedError;return ii(o,n)})}return ii(o,n)}function oc(e,n){return Tr(e,n),S(void 0)}function sc(e){let n=e._readable,o=e._transformStreamController,l=o._flushAlgorithm();return ni(o),E(l,()=>{if(n._state==="errored")throw n._storedError;Mt(n._readableStreamController)},f=>{throw Tr(e,f),n._storedError})}function cc(e){return Ar(e,!1),e._backpressureChangePromise}function Cr(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function oi(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}a.ByteLengthQueuingStrategy=Rr,a.CountQueuingStrategy=kr,a.ReadableByteStreamController=ft,a.ReadableStream=je,a.ReadableStreamBYOBReader=Pt,a.ReadableStreamBYOBRequest=At,a.ReadableStreamDefaultController=pt,a.ReadableStreamDefaultReader=Et,a.TransformStream=Er,a.TransformStreamDefaultController=Lt,a.WritableStream=It,a.WritableStreamDefaultController=ht,a.WritableStreamDefaultWriter=Bt,Object.defineProperty(a,"__esModule",{value:!0})}))});var xi=Ir(()=>{if(!globalThis.ReadableStream)try{let a=require("node:process"),{emitWarning:t}=a;try{a.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),a.emitWarning=t}catch(r){throw a.emitWarning=t,r}}catch{Object.assign(globalThis,yi())}try{let{Blob:a}=require("buffer");a&&!a.prototype.stream&&(a.prototype.stream=function(r){let i=0,s=this;return new ReadableStream({type:"bytes",async pull(c){let d=await s.slice(i,Math.min(s.size,i+65536)).arrayBuffer();i+=d.byteLength,c.enqueue(new Uint8Array(d)),i===s.size&&c.close()}})})}catch{}});async function*In(a,t=!0){for(let r of a)if("stream"in r)yield*r.stream();else if(ArrayBuffer.isView(r))if(t){let i=r.byteOffset,s=r.byteOffset+r.byteLength;for(;i!==s;){let c=Math.min(s-i,wi),u=r.buffer.slice(i,i+c);i+=u.byteLength,yield new Uint8Array(u)}}else yield r;else{let i=0,s=r;for(;i!==s.size;){let u=await s.slice(i,Math.min(s.size,i+wi)).arrayBuffer();i+=u.byteLength,yield new Uint8Array(u)}}}var El,wi,Si,Sc,De,Wt=Nt(()=>{El=X(xi(),1);wi=65536;Si=class Bn{#e=[];#t="";#r=0;#n="transparent";constructor(t=[],r={}){if(typeof t!="object"||t===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof t[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof r!="object"&&typeof r!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");r===null&&(r={});let i=new TextEncoder;for(let c of t){let u;ArrayBuffer.isView(c)?u=new Uint8Array(c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)):c instanceof ArrayBuffer?u=new Uint8Array(c.slice(0)):c instanceof Bn?u=c:u=i.encode(`${c}`),this.#r+=ArrayBuffer.isView(u)?u.byteLength:u.size,this.#e.push(u)}this.#n=`${r.endings===void 0?"transparent":r.endings}`;let s=r.type===void 0?"":String(r.type);this.#t=/^[\x20-\x7E]*$/.test(s)?s:""}get size(){return this.#r}get type(){return this.#t}async text(){let t=new TextDecoder,r="";for await(let i of In(this.#e,!1))r+=t.decode(i,{stream:!0});return r+=t.decode(),r}async arrayBuffer(){let t=new Uint8Array(this.size),r=0;for await(let i of In(this.#e,!1))t.set(i,r),r+=i.length;return t.buffer}stream(){let t=In(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(r){let i=await t.next();i.done?r.close():r.enqueue(i.value)},async cancel(){await t.return()}})}slice(t=0,r=this.size,i=""){let{size:s}=this,c=t<0?Math.max(s+t,0):Math.min(t,s),u=r<0?Math.max(s+r,0):Math.min(r,s),d=Math.max(u-c,0),m=this.#e,h=[],g=0;for(let S of m){if(g>=d)break;let y=ArrayBuffer.isView(S)?S.byteLength:S.size;if(c&&y<=c)c-=y,u-=y;else{let x;ArrayBuffer.isView(S)?(x=S.subarray(c,Math.min(y,u)),g+=x.byteLength):(x=S.slice(c,Math.min(y,u)),g+=x.size),u-=y,h.push(x),c=0}}let w=new Bn([],{type:String(i).toLowerCase()});return w.#r=d,w.#e=h,w}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](t){return t&&typeof t=="object"&&typeof t.constructor=="function"&&(typeof t.stream=="function"||typeof t.arrayBuffer=="function")&&/^(Blob|File)$/.test(t[Symbol.toStringTag])}};Object.defineProperties(Si.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Sc=Si,De=Sc});var _c,Rc,St,Fn=Nt(()=>{Wt();_c=class extends De{#e=0;#t="";constructor(t,r,i={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(t,i),i===null&&(i={});let s=i.lastModified===void 0?Date.now():Number(i.lastModified);Number.isNaN(s)||(this.#e=s),this.#t=String(r)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](t){return!!t&&t instanceof De&&/^(File)$/.test(t[Symbol.toStringTag])}},Rc=_c,St=Rc});function ki(a,t=De){var r=`${_i()}${_i()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),i=[],s=`--${r}\r
Content-Disposition: form-data; name="`;return a.forEach((c,u)=>typeof c=="string"?i.push(s+Dn(u)+`"\r
\r
${c.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):i.push(s+Dn(u)+`"; filename="${Dn(c.name,1)}"\r
Content-Type: ${c.type||"application/octet-stream"}\r
\r
`,c,`\r
`)),i.push(`--${r}--`),new t(i,{type:"multipart/form-data; boundary="+r})}var zt,kc,Ec,_i,Tc,Ri,Dn,rt,nt,Lr=Nt(()=>{Wt();Fn();({toStringTag:zt,iterator:kc,hasInstance:Ec}=Symbol),_i=Math.random,Tc="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Ri=(a,t,r)=>(a+="",/^(Blob|File)$/.test(t&&t[zt])?[(r=r!==void 0?r+"":t[zt]=="File"?t.name:"blob",a),t.name!==r||t[zt]=="blob"?new St([t],r,t):t]:[a,t+""]),Dn=(a,t)=>(t?a:a.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),rt=(a,t,r)=>{if(t.length<r)throw new TypeError(`Failed to execute '${a}' on 'FormData': ${r} arguments required, but only ${t.length} present.`)},nt=class{#e=[];constructor(...t){if(t.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[zt](){return"FormData"}[kc](){return this.entries()}static[Ec](t){return t&&typeof t=="object"&&t[zt]==="FormData"&&!Tc.some(r=>typeof t[r]!="function")}append(...t){rt("append",arguments,2),this.#e.push(Ri(...t))}delete(t){rt("delete",arguments,1),t+="",this.#e=this.#e.filter(([r])=>r!==t)}get(t){rt("get",arguments,1),t+="";for(var r=this.#e,i=r.length,s=0;s<i;s++)if(r[s][0]===t)return r[s][1];return null}getAll(t,r){return rt("getAll",arguments,1),r=[],t+="",this.#e.forEach(i=>i[0]===t&&r.push(i[1])),r}has(t){return rt("has",arguments,1),t+="",this.#e.some(r=>r[0]===t)}forEach(t,r){rt("forEach",arguments,1);for(var[i,s]of this)t.call(r,s,i,this)}set(...t){rt("set",arguments,2);var r=[],i=!0;t=Ri(...t),this.#e.forEach(s=>{s[0]===t[0]?i&&(i=!r.push(t)):r.push(s)}),i&&r.push(t),this.#e=r}*entries(){yield*this.#e}*keys(){for(var[t]of this)yield t}*values(){for(var[,t]of this)yield t}}});var $i=Ir((Ul,Ai)=>{if(!globalThis.DOMException)try{let{MessageChannel:a}=require("worker_threads"),t=new a().port1,r=new ArrayBuffer;t.postMessage(r,[r,r])}catch(a){a.constructor.name==="DOMException"&&(globalThis.DOMException=a.constructor)}Ai.exports=globalThis.DOMException});var Wr,vc,Wl,Un=Nt(()=>{Wr=require("node:fs"),vc=X($i(),1);Fn();Wt();({stat:Wl}=Wr.promises)});var Pi={};ci(Pi,{toFormData:()=>Bc});function Ic(a){let t=a.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;let r=t[2]||t[3]||"",i=r.slice(r.lastIndexOf("\\")+1);return i=i.replace(/%22/g,'"'),i=i.replace(/&#(\d{4});/g,(s,c)=>String.fromCharCode(c)),i}async function Bc(a,t){if(!/multipart/i.test(t))throw new TypeError("Failed to fetch");let r=t.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!r)throw new TypeError("no or bad content-type header, no multipart boundary");let i=new Ln(r[1]||r[2]),s,c,u,d,m,h,g=[],w=new nt,S=k=>{u+=A.decode(k,{stream:!0})},y=k=>{g.push(k)},x=()=>{let k=new St(g,h,{type:m});w.append(d,k)},T=()=>{w.append(d,u)},A=new TextDecoder("utf-8");A.decode(),i.onPartBegin=function(){i.onPartData=S,i.onPartEnd=T,s="",c="",u="",d="",m="",h=null,g.length=0},i.onHeaderField=function(k){s+=A.decode(k,{stream:!0})},i.onHeaderValue=function(k){c+=A.decode(k,{stream:!0})},i.onHeaderEnd=function(){if(c+=A.decode(),s=s.toLowerCase(),s==="content-disposition"){let k=c.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);k&&(d=k[2]||k[3]||""),h=Ic(c),h&&(i.onPartData=y,i.onPartEnd=x)}else s==="content-type"&&(m=c);c="",s=""};for await(let k of a)i.write(k);return i.end(),w}var Ae,V,Ci,Ge,zr,jr,Ac,qt,$c,Cc,Pc,Oc,at,Ln,Oi=Nt(()=>{Un();Lr();Ae=0,V={START_BOUNDARY:Ae++,HEADER_FIELD_START:Ae++,HEADER_FIELD:Ae++,HEADER_VALUE_START:Ae++,HEADER_VALUE:Ae++,HEADER_VALUE_ALMOST_DONE:Ae++,HEADERS_ALMOST_DONE:Ae++,PART_DATA_START:Ae++,PART_DATA:Ae++,END:Ae++},Ci=1,Ge={PART_BOUNDARY:Ci,LAST_BOUNDARY:Ci*=2},zr=10,jr=13,Ac=32,qt=45,$c=58,Cc=97,Pc=122,Oc=a=>a|32,at=()=>{},Ln=class{constructor(t){this.index=0,this.flags=0,this.onHeaderEnd=at,this.onHeaderField=at,this.onHeadersEnd=at,this.onHeaderValue=at,this.onPartBegin=at,this.onPartData=at,this.onPartEnd=at,this.boundaryChars={},t=`\r
--`+t;let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i),this.boundaryChars[r[i]]=!0;this.boundary=r,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=V.START_BOUNDARY}write(t){let r=0,i=t.length,s=this.index,{lookbehind:c,boundary:u,boundaryChars:d,index:m,state:h,flags:g}=this,w=this.boundary.length,S=w-1,y=t.length,x,T,A=_=>{this[_+"Mark"]=r},k=_=>{delete this[_+"Mark"]},E=(_,I,P,Re)=>{(I===void 0||I!==P)&&this[_](Re&&Re.subarray(I,P))},O=(_,I)=>{let P=_+"Mark";P in this&&(I?(E(_,this[P],r,t),delete this[P]):(E(_,this[P],t.length,t),this[P]=0))};for(r=0;r<i;r++)switch(x=t[r],h){case V.START_BOUNDARY:if(m===u.length-2){if(x===qt)g|=Ge.LAST_BOUNDARY;else if(x!==jr)return;m++;break}else if(m-1===u.length-2){if(g&Ge.LAST_BOUNDARY&&x===qt)h=V.END,g=0;else if(!(g&Ge.LAST_BOUNDARY)&&x===zr)m=0,E("onPartBegin"),h=V.HEADER_FIELD_START;else return;break}x!==u[m+2]&&(m=-2),x===u[m+2]&&m++;break;case V.HEADER_FIELD_START:h=V.HEADER_FIELD,A("onHeaderField"),m=0;case V.HEADER_FIELD:if(x===jr){k("onHeaderField"),h=V.HEADERS_ALMOST_DONE;break}if(m++,x===qt)break;if(x===$c){if(m===1)return;O("onHeaderField",!0),h=V.HEADER_VALUE_START;break}if(T=Oc(x),T<Cc||T>Pc)return;break;case V.HEADER_VALUE_START:if(x===Ac)break;A("onHeaderValue"),h=V.HEADER_VALUE;case V.HEADER_VALUE:x===jr&&(O("onHeaderValue",!0),E("onHeaderEnd"),h=V.HEADER_VALUE_ALMOST_DONE);break;case V.HEADER_VALUE_ALMOST_DONE:if(x!==zr)return;h=V.HEADER_FIELD_START;break;case V.HEADERS_ALMOST_DONE:if(x!==zr)return;E("onHeadersEnd"),h=V.PART_DATA_START;break;case V.PART_DATA_START:h=V.PART_DATA,A("onPartData");case V.PART_DATA:if(s=m,m===0){for(r+=S;r<y&&!(t[r]in d);)r+=w;r-=S,x=t[r]}if(m<u.length)u[m]===x?(m===0&&O("onPartData",!0),m++):m=0;else if(m===u.length)m++,x===jr?g|=Ge.PART_BOUNDARY:x===qt?g|=Ge.LAST_BOUNDARY:m=0;else if(m-1===u.length)if(g&Ge.PART_BOUNDARY){if(m=0,x===zr){g&=~Ge.PART_BOUNDARY,E("onPartEnd"),E("onPartBegin"),h=V.HEADER_FIELD_START;break}}else g&Ge.LAST_BOUNDARY&&x===qt?(E("onPartEnd"),h=V.END,g=0):m=0;if(m>0)c[m-1]=x;else if(s>0){let _=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);E("onPartData",0,s,_),s=0,A("onPartData"),r--}break;case V.END:break;default:throw new Error(`Unexpected state entered: ${h}`)}O("onHeaderField"),O("onHeaderValue"),O("onPartData"),this.index=m,this.state=h,this.flags=g}end(){if(this.state===V.HEADER_FIELD_START&&this.index===0||this.state===V.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==V.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});var io=Ir(Vn=>{Vn.read=function(a,t,r,i,s){var c,u,d=s*8-i-1,m=(1<<d)-1,h=m>>1,g=-7,w=r?s-1:0,S=r?-1:1,y=a[t+w];for(w+=S,c=y&(1<<-g)-1,y>>=-g,g+=d;g>0;c=c*256+a[t+w],w+=S,g-=8);for(u=c&(1<<-g)-1,c>>=-g,g+=i;g>0;u=u*256+a[t+w],w+=S,g-=8);if(c===0)c=1-h;else{if(c===m)return u?NaN:(y?-1:1)*(1/0);u=u+Math.pow(2,i),c=c-h}return(y?-1:1)*u*Math.pow(2,c-i)};Vn.write=function(a,t,r,i,s,c){var u,d,m,h=c*8-s-1,g=(1<<h)-1,w=g>>1,S=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=i?0:c-1,x=i?1:-1,T=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(d=isNaN(t)?1:0,u=g):(u=Math.floor(Math.log(t)/Math.LN2),t*(m=Math.pow(2,-u))<1&&(u--,m*=2),u+w>=1?t+=S/m:t+=S*Math.pow(2,1-w),t*m>=2&&(u++,m/=2),u+w>=g?(d=0,u=g):u+w>=1?(d=(t*m-1)*Math.pow(2,s),u=u+w):(d=t*Math.pow(2,w-1)*Math.pow(2,s),u=0));s>=8;a[r+y]=d&255,y+=x,d/=256,s-=8);for(u=u<<s|d,h+=s;h>0;a[r+y]=u&255,y+=x,u/=256,h-=8);a[r+y-x]|=T*128}});var pl={};ci(pl,{default:()=>Uo});module.exports=hc(pl);var fe=X(require("react")),C=require("@raycast/api");var D=X(require("react")),j=require("@raycast/api");var ui=Object.prototype.hasOwnProperty;function Br(a,t){var r,i;if(a===t)return!0;if(a&&t&&(r=a.constructor)===t.constructor){if(r===Date)return a.getTime()===t.getTime();if(r===RegExp)return a.toString()===t.toString();if(r===Array){if((i=a.length)===t.length)for(;i--&&Br(a[i],t[i]););return i===-1}if(!r||typeof a=="object"){i=0;for(r in a)if(ui.call(a,r)&&++i&&!ui.call(t,r)||!(r in t)||!Br(a[r],t[r]))return!1;return Object.keys(t).length===i}}return a!==a&&t!==t}var et=X(require("node:fs")),Fr=X(require("node:path"));var di=require("react/jsx-runtime");function pc(a){let t=(0,D.useRef)(a),r=(0,D.useRef)(0);return Br(a,t.current)||(t.current=a,r.current+=1),(0,D.useMemo)(()=>t.current,[r.current])}function Te(a){let t=(0,D.useRef)(a);return t.current=a,t}function gc(a,t){let r=a instanceof Error?a.message:String(a);return(0,j.showToast)({style:j.Toast.Style.Failure,title:t?.title??"Something went wrong",message:t?.message??r,primaryAction:t?.primaryAction??fi(a),secondaryAction:t?.primaryAction?fi(a):void 0})}var fi=a=>{let t=!0,r="[Extension Name]...",i="";try{let u=JSON.parse((0,et.readFileSync)((0,Fr.join)(j.environment.assetsPath,"..","package.json"),"utf8"));r=`[${u.title}]...`,i=`https://raycast.com/${u.owner||u.author}/${u.name}`,(!u.owner||u.access==="public")&&(t=!1)}catch{}let s=j.environment.isDevelopment||t,c=a instanceof Error?a?.stack||a?.message||"":String(a);return{title:s?"Copy Logs":"Report Error",onAction(u){u.hide(),s?j.Clipboard.copy(c):(0,j.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(i)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${c}
\`\`\`
`)}`)}}};function Dr(a,t,r){let i=(0,D.useRef)(0),[s,c]=(0,D.useState)({isLoading:!0}),u=Te(a),d=Te(r?.abortable),m=Te(t||[]),h=Te(r?.onError),g=Te(r?.onData),w=Te(r?.onWillExecute),S=Te(r?.failureToastOptions),y=Te(s.data),x=(0,D.useRef)(null),T=(0,D.useRef)({page:0}),A=(0,D.useRef)(!1),k=(0,D.useRef)(!0),E=(0,D.useRef)(50),O=(0,D.useCallback)(()=>(d.current&&(d.current.current?.abort(),d.current.current=new AbortController),++i.current),[d]),_=(0,D.useCallback)((...Y)=>{let G=O();w.current?.(Y),c(L=>({...L,isLoading:!0}));let ke=bc(u.current)(...Y);function Pe(L){return L.name=="AbortError"||G===i.current&&(h.current?h.current(L):j.environment.launchType!==j.LaunchType.Background&&gc(L,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(be){be.hide(),x.current?.(...m.current||[])}},...S.current}),c({error:L,isLoading:!1})),L}return typeof ke=="function"?(A.current=!0,ke(T.current).then(({data:L,hasMore:be,cursor:en})=>(G===i.current&&(T.current&&(T.current.cursor=en,T.current.lastItem=L?.[L.length-1]),g.current&&g.current(L,T.current),be&&(E.current=L.length),k.current=be,c(Xt=>T.current.page===0?{data:L,isLoading:!1}:{data:(Xt.data||[])?.concat(L),isLoading:!1})),L),L=>(k.current=!1,Pe(L)))):(A.current=!1,ke.then(L=>(G===i.current&&(g.current&&g.current(L),c({data:L,isLoading:!1})),L),Pe))},[g,h,m,u,c,x,w,T,S,O]);x.current=_;let I=(0,D.useCallback)(()=>{T.current={page:0};let Y=m.current||[];return _(...Y)},[_,m]),P=(0,D.useCallback)(async(Y,G)=>{let ke;try{if(G?.optimisticUpdate){O(),typeof G?.rollbackOnError!="function"&&G?.rollbackOnError!==!1&&(ke=structuredClone(y.current?.value));let Pe=G.optimisticUpdate;c(L=>({...L,data:Pe(L.data)}))}return await Y}catch(Pe){if(typeof G?.rollbackOnError=="function"){let L=G.rollbackOnError;c(be=>({...be,data:L(be.data)}))}else G?.optimisticUpdate&&G?.rollbackOnError!==!1&&c(L=>({...L,data:ke}));throw Pe}finally{G?.shouldRevalidateAfter!==!1&&(j.environment.launchType===j.LaunchType.Background||j.environment.commandMode==="menu-bar"?await I():I())}},[I,y,c,O]),Re=(0,D.useCallback)(()=>{T.current.page+=1;let Y=m.current||[];_(...Y)},[T,m,_]);(0,D.useEffect)(()=>{T.current={page:0},r?.execute!==!1?_(...t||[]):O()},[pc([t,r?.execute,_]),d,T]),(0,D.useEffect)(()=>()=>{O()},[O]);let Q=r?.execute!==!1?s.isLoading:!1,Zt={...s,isLoading:Q},kt=A.current?{pageSize:E.current,hasMore:k.current,onLoadMore:Re}:void 0;return{...Zt,revalidate:I,mutate:P,pagination:kt}}function bc(a){return a===Promise.all||a===Promise.race||a===Promise.resolve||a===Promise.reject?a.bind(Promise):a}var On=(function(a){return a.Required="required",a})({});function Pn(a,t){if(a){if(typeof a=="function")return a(t);if(a==="required"){let r=typeof t<"u"&&t!==null;if(r)switch(typeof t){case"string":r=t.length>0;break;case"object":Array.isArray(t)?r=t.length>0:t instanceof Date&&(r=t.getTime()>0);break;default:break}if(!r)return"The item is required"}}}function mi(a){let{onSubmit:t,validation:r,initialValues:i={}}=a,[s,c]=(0,D.useState)(i),[u,d]=(0,D.useState)({}),m=(0,D.useRef)({}),h=Te(r||{}),g=Te(t),w=(0,D.useCallback)(k=>{m.current[k]?.focus()},[m]),S=(0,D.useCallback)(async k=>{let E=!1;for(let[_,I]of Object.entries(h.current)){let P=Pn(I,k[_]);P&&(E||(E={},w(_)),E[_]=P)}if(E)return d(E),!1;let O=await g.current(k);return typeof O=="boolean"?O:!0},[h,g,w]),y=(0,D.useCallback)((k,E)=>{d(O=>({...O,[k]:E}))},[d]),x=(0,D.useCallback)(function(k,E){c(O=>({...O,[k]:typeof E=="function"?E(O[k]):E}))},[c]),T=(0,D.useMemo)(()=>new Proxy({},{get(k,E){let O=h.current[E],_=s[E];return{onChange(I){u[E]&&(Pn(O,I)||y(E,void 0)),x(E,I)},onBlur(I){let P=Pn(O,I.target.value);P&&y(E,P)},error:u[E],id:E,value:typeof _>"u"?null:_,ref:I=>{m.current[E]=I}}}}),[u,h,y,s,m,x]),A=(0,D.useCallback)(k=>{d({}),Object.entries(m.current).forEach(([E,O])=>{k?.[E]||O?.reset()}),k&&c(k)},[c,d,m]);return{handleSubmit:S,setValidationError:y,setValue:x,values:s,itemProps:T,focus:w,reset:A}}var hi=new Error("Model is not Installed."),pi=new Error("Ollama version not supported, update at least at v0.1.14."),ve=new Error("Verify Ollama is Installed and Currently Running."),Sl=new Error("Ollama Models Registry is Unreachable."),Mr=class extends Error{constructor(t,r){super(t),this.model=r,this.suggest="Select a different model or install throw 'Manage Models' command"}},tt=class extends Error{constructor(t,r,i,s){super(t),this.route=r,this.code=i,this.req=s}};var Gi=X(require("node:http"),1),Ji=X(require("node:https"),1),ot=X(require("node:zlib"),1),le=X(require("node:stream"),1),Gt=require("node:buffer");function wc(a){if(!/^data:/i.test(a))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');a=a.replace(/\r?\n/g,"");let t=a.indexOf(",");if(t===-1||t<=4)throw new TypeError("malformed data: URI");let r=a.substring(5,t).split(";"),i="",s=!1,c=r[0]||"text/plain",u=c;for(let g=1;g<r.length;g++)r[g]==="base64"?s=!0:r[g]&&(u+=`;${r[g]}`,r[g].indexOf("charset=")===0&&(i=r[g].substring(8)));!r[0]&&!i.length&&(u+=";charset=US-ASCII",i="US-ASCII");let d=s?"base64":"ascii",m=unescape(a.substring(t+1)),h=Buffer.from(m,d);return h.type=c,h.typeFull=u,h.charset=i,h}var gi=wc;var me=X(require("node:stream"),1),Ue=require("node:util"),se=require("node:buffer");Wt();Lr();var Me=class extends Error{constructor(t,r){super(t),Error.captureStackTrace(this,this.constructor),this.type=r}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var H=class extends Me{constructor(t,r,i){super(t,r),i&&(this.code=this.errno=i.code,this.erroredSysCall=i.syscall)}};var Nr=Symbol.toStringTag,Mn=a=>typeof a=="object"&&typeof a.append=="function"&&typeof a.delete=="function"&&typeof a.get=="function"&&typeof a.getAll=="function"&&typeof a.has=="function"&&typeof a.set=="function"&&typeof a.sort=="function"&&a[Nr]==="URLSearchParams",jt=a=>a&&typeof a=="object"&&typeof a.arrayBuffer=="function"&&typeof a.type=="string"&&typeof a.stream=="function"&&typeof a.constructor=="function"&&/^(Blob|File)$/.test(a[Nr]),Ei=a=>typeof a=="object"&&(a[Nr]==="AbortSignal"||a[Nr]==="EventTarget"),Ti=(a,t)=>{let r=new URL(t).hostname,i=new URL(a).hostname;return r===i||r.endsWith(`.${i}`)},vi=(a,t)=>{let r=new URL(t).protocol,i=new URL(a).protocol;return r===i};var Fc=(0,Ue.promisify)(me.default.pipeline),ne=Symbol("Body internals"),$e=class{constructor(t,{size:r=0}={}){let i=null;t===null?t=null:Mn(t)?t=se.Buffer.from(t.toString()):jt(t)||se.Buffer.isBuffer(t)||(Ue.types.isAnyArrayBuffer(t)?t=se.Buffer.from(t):ArrayBuffer.isView(t)?t=se.Buffer.from(t.buffer,t.byteOffset,t.byteLength):t instanceof me.default||(t instanceof nt?(t=ki(t),i=t.type.split("=")[1]):t=se.Buffer.from(String(t))));let s=t;se.Buffer.isBuffer(t)?s=me.default.Readable.from(t):jt(t)&&(s=me.default.Readable.from(t.stream())),this[ne]={body:t,stream:s,boundary:i,disturbed:!1,error:null},this.size=r,t instanceof me.default&&t.on("error",c=>{let u=c instanceof Me?c:new H(`Invalid response body while trying to fetch ${this.url}: ${c.message}`,"system",c);this[ne].error=u})}get body(){return this[ne].stream}get bodyUsed(){return this[ne].disturbed}async arrayBuffer(){let{buffer:t,byteOffset:r,byteLength:i}=await Nn(this);return t.slice(r,r+i)}async formData(){let t=this.headers.get("content-type");if(t.startsWith("application/x-www-form-urlencoded")){let i=new nt,s=new URLSearchParams(await this.text());for(let[c,u]of s)i.append(c,u);return i}let{toFormData:r}=await Promise.resolve().then(()=>(Oi(),Pi));return r(this.body,t)}async blob(){let t=this.headers&&this.headers.get("content-type")||this[ne].body&&this[ne].body.type||"",r=await this.arrayBuffer();return new De([r],{type:t})}async json(){let t=await this.text();return JSON.parse(t)}async text(){let t=await Nn(this);return new TextDecoder().decode(t)}buffer(){return Nn(this)}};$e.prototype.buffer=(0,Ue.deprecate)($e.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties($e.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,Ue.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});async function Nn(a){if(a[ne].disturbed)throw new TypeError(`body used already for: ${a.url}`);if(a[ne].disturbed=!0,a[ne].error)throw a[ne].error;let{body:t}=a;if(t===null)return se.Buffer.alloc(0);if(!(t instanceof me.default))return se.Buffer.alloc(0);let r=[],i=0;try{for await(let s of t){if(a.size>0&&i+s.length>a.size){let c=new H(`content size at ${a.url} over limit: ${a.size}`,"max-size");throw t.destroy(c),c}i+=s.length,r.push(s)}}catch(s){throw s instanceof Me?s:new H(`Invalid response body while trying to fetch ${a.url}: ${s.message}`,"system",s)}if(t.readableEnded===!0||t._readableState.ended===!0)try{return r.every(s=>typeof s=="string")?se.Buffer.from(r.join("")):se.Buffer.concat(r,i)}catch(s){throw new H(`Could not create Buffer from response body for ${a.url}: ${s.message}`,"system",s)}else throw new H(`Premature close of server response while trying to fetch ${a.url}`)}var _t=(a,t)=>{let r,i,{body:s}=a[ne];if(a.bodyUsed)throw new Error("cannot clone body after it is used");return s instanceof me.default&&typeof s.getBoundary!="function"&&(r=new me.PassThrough({highWaterMark:t}),i=new me.PassThrough({highWaterMark:t}),s.pipe(r),s.pipe(i),a[ne].stream=r,s=i),s},Dc=(0,Ue.deprecate)(a=>a.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),qr=(a,t)=>a===null?null:typeof a=="string"?"text/plain;charset=UTF-8":Mn(a)?"application/x-www-form-urlencoded;charset=UTF-8":jt(a)?a.type||null:se.Buffer.isBuffer(a)||Ue.types.isAnyArrayBuffer(a)||ArrayBuffer.isView(a)?null:a instanceof nt?`multipart/form-data; boundary=${t[ne].boundary}`:a&&typeof a.getBoundary=="function"?`multipart/form-data;boundary=${Dc(a)}`:a instanceof me.default?null:"text/plain;charset=UTF-8",Ii=a=>{let{body:t}=a[ne];return t===null?0:jt(t)?t.size:se.Buffer.isBuffer(t)?t.length:t&&typeof t.getLengthSync=="function"&&t.hasKnownLength&&t.hasKnownLength()?t.getLengthSync():null},Bi=async(a,{body:t})=>{t===null?a.end():await Fc(t,a)};var Wn=require("node:util"),Vt=X(require("node:http"),1),Vr=typeof Vt.default.validateHeaderName=="function"?Vt.default.validateHeaderName:a=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(a)){let t=new TypeError(`Header name must be a valid HTTP token [${a}]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),t}},zn=typeof Vt.default.validateHeaderValue=="function"?Vt.default.validateHeaderValue:(a,t)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(t)){let r=new TypeError(`Invalid character in header content ["${a}"]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_CHAR"}),r}},ce=class a extends URLSearchParams{constructor(t){let r=[];if(t instanceof a){let i=t.raw();for(let[s,c]of Object.entries(i))r.push(...c.map(u=>[s,u]))}else if(t!=null)if(typeof t=="object"&&!Wn.types.isBoxedPrimitive(t)){let i=t[Symbol.iterator];if(i==null)r.push(...Object.entries(t));else{if(typeof i!="function")throw new TypeError("Header pairs must be iterable");r=[...t].map(s=>{if(typeof s!="object"||Wn.types.isBoxedPrimitive(s))throw new TypeError("Each header pair must be an iterable object");return[...s]}).map(s=>{if(s.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...s]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return r=r.length>0?r.map(([i,s])=>(Vr(i),zn(i,String(s)),[String(i).toLowerCase(),String(s)])):void 0,super(r),new Proxy(this,{get(i,s,c){switch(s){case"append":case"set":return(u,d)=>(Vr(u),zn(u,String(d)),URLSearchParams.prototype[s].call(i,String(u).toLowerCase(),String(d)));case"delete":case"has":case"getAll":return u=>(Vr(u),URLSearchParams.prototype[s].call(i,String(u).toLowerCase()));case"keys":return()=>(i.sort(),new Set(URLSearchParams.prototype.keys.call(i)).keys());default:return Reflect.get(i,s,c)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(t){let r=this.getAll(t);if(r.length===0)return null;let i=r.join(", ");return/^content-encoding$/i.test(t)&&(i=i.toLowerCase()),i}forEach(t,r=void 0){for(let i of this.keys())Reflect.apply(t,r,[this.get(i),i,this])}*values(){for(let t of this.keys())yield this.get(t)}*entries(){for(let t of this.keys())yield[t,this.get(t)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((t,r)=>(t[r]=this.getAll(r),t),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((t,r)=>{let i=this.getAll(r);return r==="host"?t[r]=i[0]:t[r]=i.length>1?i:i[0],t},{})}};Object.defineProperties(ce.prototype,["get","entries","forEach","values"].reduce((a,t)=>(a[t]={enumerable:!0},a),{}));function Fi(a=[]){return new ce(a.reduce((t,r,i,s)=>(i%2===0&&t.push(s.slice(i,i+2)),t),[]).filter(([t,r])=>{try{return Vr(t),zn(t,String(r)),!0}catch{return!1}}))}var Mc=new Set([301,302,303,307,308]),Hr=a=>Mc.has(a);var _e=Symbol("Response internals"),he=class a extends $e{constructor(t=null,r={}){super(t,r);let i=r.status!=null?r.status:200,s=new ce(r.headers);if(t!==null&&!s.has("Content-Type")){let c=qr(t,this);c&&s.append("Content-Type",c)}this[_e]={type:"default",url:r.url,status:i,statusText:r.statusText||"",headers:s,counter:r.counter,highWaterMark:r.highWaterMark}}get type(){return this[_e].type}get url(){return this[_e].url||""}get status(){return this[_e].status}get ok(){return this[_e].status>=200&&this[_e].status<300}get redirected(){return this[_e].counter>0}get statusText(){return this[_e].statusText}get headers(){return this[_e].headers}get highWaterMark(){return this[_e].highWaterMark}clone(){return new a(_t(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(t,r=302){if(!Hr(r))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new a(null,{headers:{location:new URL(t).toString()},status:r})}static error(){let t=new a(null,{status:0,statusText:""});return t[_e].type="error",t}static json(t=void 0,r={}){let i=JSON.stringify(t);if(i===void 0)throw new TypeError("data is not JSON serializable");let s=new ce(r&&r.headers);return s.has("content-type")||s.set("content-type","application/json"),new a(i,{...r,headers:s})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(he.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var qi=require("node:url"),Vi=require("node:util");var Di=a=>{if(a.search)return a.search;let t=a.href.length-1,r=a.hash||(a.href[t]==="#"?"#":"");return a.href[t-r.length]==="?"?"?":""};var Ui=require("node:net");function Mi(a,t=!1){return a==null||(a=new URL(a),/^(about|blob|data):$/.test(a.protocol))?"no-referrer":(a.username="",a.password="",a.hash="",t&&(a.pathname="",a.search=""),a)}var Li=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),Ni="strict-origin-when-cross-origin";function Wi(a){if(!Li.has(a))throw new TypeError(`Invalid referrerPolicy: ${a}`);return a}function Uc(a){if(/^(http|ws)s:$/.test(a.protocol))return!0;let t=a.host.replace(/(^\[)|(]$)/g,""),r=(0,Ui.isIP)(t);return r===4&&/^127\./.test(t)||r===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(t)?!0:a.host==="localhost"||a.host.endsWith(".localhost")?!1:a.protocol==="file:"}function Rt(a){return/^about:(blank|srcdoc)$/.test(a)||a.protocol==="data:"||/^(blob|filesystem):$/.test(a.protocol)?!0:Uc(a)}function zi(a,{referrerURLCallback:t,referrerOriginCallback:r}={}){if(a.referrer==="no-referrer"||a.referrerPolicy==="")return null;let i=a.referrerPolicy;if(a.referrer==="about:client")return"no-referrer";let s=a.referrer,c=Mi(s),u=Mi(s,!0);c.toString().length>4096&&(c=u),t&&(c=t(c)),r&&(u=r(u));let d=new URL(a.url);switch(i){case"no-referrer":return"no-referrer";case"origin":return u;case"unsafe-url":return c;case"strict-origin":return Rt(c)&&!Rt(d)?"no-referrer":u.toString();case"strict-origin-when-cross-origin":return c.origin===d.origin?c:Rt(c)&&!Rt(d)?"no-referrer":u;case"same-origin":return c.origin===d.origin?c:"no-referrer";case"origin-when-cross-origin":return c.origin===d.origin?c:u;case"no-referrer-when-downgrade":return Rt(c)&&!Rt(d)?"no-referrer":c;default:throw new TypeError(`Invalid referrerPolicy: ${i}`)}}function ji(a){let t=(a.get("referrer-policy")||"").split(/[,\s]+/),r="";for(let i of t)i&&Li.has(i)&&(r=i);return r}var K=Symbol("Request internals"),Ht=a=>typeof a=="object"&&typeof a[K]=="object",Lc=(0,Vi.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),it=class a extends $e{constructor(t,r={}){let i;if(Ht(t)?i=new URL(t.url):(i=new URL(t),t={}),i.username!==""||i.password!=="")throw new TypeError(`${i} is an url with embedded credentials.`);let s=r.method||t.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(s)&&(s=s.toUpperCase()),!Ht(r)&&"data"in r&&Lc(),(r.body!=null||Ht(t)&&t.body!==null)&&(s==="GET"||s==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let c=r.body?r.body:Ht(t)&&t.body!==null?_t(t):null;super(c,{size:r.size||t.size||0});let u=new ce(r.headers||t.headers||{});if(c!==null&&!u.has("Content-Type")){let h=qr(c,this);h&&u.set("Content-Type",h)}let d=Ht(t)?t.signal:null;if("signal"in r&&(d=r.signal),d!=null&&!Ei(d))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let m=r.referrer==null?t.referrer:r.referrer;if(m==="")m="no-referrer";else if(m){let h=new URL(m);m=/^about:(\/\/)?client$/.test(h)?"client":h}else m=void 0;this[K]={method:s,redirect:r.redirect||t.redirect||"follow",headers:u,parsedURL:i,signal:d,referrer:m},this.follow=r.follow===void 0?t.follow===void 0?20:t.follow:r.follow,this.compress=r.compress===void 0?t.compress===void 0?!0:t.compress:r.compress,this.counter=r.counter||t.counter||0,this.agent=r.agent||t.agent,this.highWaterMark=r.highWaterMark||t.highWaterMark||16384,this.insecureHTTPParser=r.insecureHTTPParser||t.insecureHTTPParser||!1,this.referrerPolicy=r.referrerPolicy||t.referrerPolicy||""}get method(){return this[K].method}get url(){return(0,qi.format)(this[K].parsedURL)}get headers(){return this[K].headers}get redirect(){return this[K].redirect}get signal(){return this[K].signal}get referrer(){if(this[K].referrer==="no-referrer")return"";if(this[K].referrer==="client")return"about:client";if(this[K].referrer)return this[K].referrer.toString()}get referrerPolicy(){return this[K].referrerPolicy}set referrerPolicy(t){this[K].referrerPolicy=Wi(t)}clone(){return new a(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(it.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});var Hi=a=>{let{parsedURL:t}=a[K],r=new ce(a[K].headers);r.has("Accept")||r.set("Accept","*/*");let i=null;if(a.body===null&&/^(post|put)$/i.test(a.method)&&(i="0"),a.body!==null){let d=Ii(a);typeof d=="number"&&!Number.isNaN(d)&&(i=String(d))}i&&r.set("Content-Length",i),a.referrerPolicy===""&&(a.referrerPolicy=Ni),a.referrer&&a.referrer!=="no-referrer"?a[K].referrer=zi(a):a[K].referrer="no-referrer",a[K].referrer instanceof URL&&r.set("Referer",a.referrer),r.has("User-Agent")||r.set("User-Agent","node-fetch"),a.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip, deflate, br");let{agent:s}=a;typeof s=="function"&&(s=s(t));let c=Di(t),u={path:t.pathname+c,method:a.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:a.insecureHTTPParser,agent:s};return{parsedURL:t,options:u}};var Gr=class extends Me{constructor(t,r="aborted"){super(t,r)}};Lr();Un();var Nc=new Set(["data:","http:","https:"]);async function ae(a,t){return new Promise((r,i)=>{let s=new it(a,t),{parsedURL:c,options:u}=Hi(s);if(!Nc.has(c.protocol))throw new TypeError(`node-fetch cannot load ${a}. URL scheme "${c.protocol.replace(/:$/,"")}" is not supported.`);if(c.protocol==="data:"){let x=gi(s.url),T=new he(x,{headers:{"Content-Type":x.typeFull}});r(T);return}let d=(c.protocol==="https:"?Ji.default:Gi.default).request,{signal:m}=s,h=null,g=()=>{let x=new Gr("The operation was aborted.");i(x),s.body&&s.body instanceof le.default.Readable&&s.body.destroy(x),!(!h||!h.body)&&h.body.emit("error",x)};if(m&&m.aborted){g();return}let w=()=>{g(),y()},S=d(c.toString(),u);m&&m.addEventListener("abort",w);let y=()=>{S.abort(),m&&m.removeEventListener("abort",w)};S.on("error",x=>{i(new H(`request to ${s.url} failed, reason: ${x.message}`,"system",x)),y()}),Wc(S,x=>{h&&h.body&&h.body.destroy(x)}),process.version<"v14"&&S.on("socket",x=>{let T;x.prependListener("end",()=>{T=x._eventsCount}),x.prependListener("close",A=>{if(h&&T<x._eventsCount&&!A){let k=new Error("Premature close");k.code="ERR_STREAM_PREMATURE_CLOSE",h.body.emit("error",k)}})}),S.on("response",x=>{S.setTimeout(0);let T=Fi(x.rawHeaders);if(Hr(x.statusCode)){let _=T.get("Location"),I=null;try{I=_===null?null:new URL(_,s.url)}catch{if(s.redirect!=="manual"){i(new H(`uri requested responds with an invalid redirect URL: ${_}`,"invalid-redirect")),y();return}}switch(s.redirect){case"error":i(new H(`uri requested responds with a redirect, redirect mode is set to error: ${s.url}`,"no-redirect")),y();return;case"manual":break;case"follow":{if(I===null)break;if(s.counter>=s.follow){i(new H(`maximum redirect reached at: ${s.url}`,"max-redirect")),y();return}let P={headers:new ce(s.headers),follow:s.follow,counter:s.counter+1,agent:s.agent,compress:s.compress,method:s.method,body:_t(s),signal:s.signal,size:s.size,referrer:s.referrer,referrerPolicy:s.referrerPolicy};if(!Ti(s.url,I)||!vi(s.url,I))for(let Q of["authorization","www-authenticate","cookie","cookie2"])P.headers.delete(Q);if(x.statusCode!==303&&s.body&&t.body instanceof le.default.Readable){i(new H("Cannot follow redirect with body being a readable stream","unsupported-redirect")),y();return}(x.statusCode===303||(x.statusCode===301||x.statusCode===302)&&s.method==="POST")&&(P.method="GET",P.body=void 0,P.headers.delete("content-length"));let Re=ji(T);Re&&(P.referrerPolicy=Re),r(ae(new it(I,P))),y();return}default:return i(new TypeError(`Redirect option '${s.redirect}' is not a valid value of RequestRedirect`))}}m&&x.once("end",()=>{m.removeEventListener("abort",w)});let A=(0,le.pipeline)(x,new le.PassThrough,_=>{_&&i(_)});process.version<"v12.10"&&x.on("aborted",w);let k={url:s.url,status:x.statusCode,statusText:x.statusMessage,headers:T,size:s.size,counter:s.counter,highWaterMark:s.highWaterMark},E=T.get("Content-Encoding");if(!s.compress||s.method==="HEAD"||E===null||x.statusCode===204||x.statusCode===304){h=new he(A,k),r(h);return}let O={flush:ot.default.Z_SYNC_FLUSH,finishFlush:ot.default.Z_SYNC_FLUSH};if(E==="gzip"||E==="x-gzip"){A=(0,le.pipeline)(A,ot.default.createGunzip(O),_=>{_&&i(_)}),h=new he(A,k),r(h);return}if(E==="deflate"||E==="x-deflate"){let _=(0,le.pipeline)(x,new le.PassThrough,I=>{I&&i(I)});_.once("data",I=>{(I[0]&15)===8?A=(0,le.pipeline)(A,ot.default.createInflate(),P=>{P&&i(P)}):A=(0,le.pipeline)(A,ot.default.createInflateRaw(),P=>{P&&i(P)}),h=new he(A,k),r(h)}),_.once("end",()=>{h||(h=new he(A,k),r(h))});return}if(E==="br"){A=(0,le.pipeline)(A,ot.default.createBrotliDecompress(),_=>{_&&i(_)}),h=new he(A,k),r(h);return}h=new he(A,k),r(h)}),Bi(S,s).catch(i)})}function Wc(a,t){let r=Gt.Buffer.from(`0\r
\r
`),i=!1,s=!1,c;a.on("response",u=>{let{headers:d}=u;i=d["transfer-encoding"]==="chunked"&&!d["content-length"]}),a.on("socket",u=>{let d=()=>{if(i&&!s){let h=new Error("Premature close");h.code="ERR_STREAM_PREMATURE_CLOSE",t(h)}},m=h=>{s=Gt.Buffer.compare(h.slice(-5),r)===0,!s&&c&&(s=Gt.Buffer.compare(c.slice(-3),r.slice(0,3))===0&&Gt.Buffer.compare(h.slice(-2),r.slice(3))===0),c=h};u.prependListener("close",d),u.on("data",m),a.on("close",()=>{u.removeListener("close",d),u.removeListener("data",m)})})}var jn=require("stream");var st=class{constructor(t={url:"http://127.0.0.1:11434"}){this._RouteApiVersion="/api/version";this._RouteApiTags="/api/tags";this._RouteApiShow="/api/show";this._RouteApiDelete="/api/delete";this._RouteApiPull="/api/pull";this._RouteApiGenerate="/api/generate";this._RouteApiChat="/api/chat";this._RouteApiEmbeddings="/api/embeddings";this._RouteApiPs="/api/ps";this._signal=AbortSignal.timeout(1800),this._server=t.url,t.auth&&t.auth.mode==="Basic"&&(this._headers={Authorization:`${t.auth.mode} ${btoa(`${t.auth.username}:${t.auth.password}`)}`}),t.auth&&t.auth.mode==="Bearer"&&(this._headers={Authorization:`${t.auth.mode} ${t.auth.token}`})}set server(t){this._server=t.url,t.auth&&t.auth.mode==="Basic"&&(this._headers={Authorization:`${t.auth.mode} ${btoa(`${t.auth.username}:${t.auth.password}`)}`}),t.auth&&t.auth.mode==="Bearer"&&(this._headers={Authorization:`${t.auth.mode} ${t.auth.token}`})}_ErrorLogger(t){t instanceof tt?console.error(`Error: Route '${t.route}', Code '${t.code}', Message: ${t.message}${t.req&&` Req: ${t.req}`}`):console.error(`Error: ${t.message}`),t.stack&&console.error(`Stack trace: ${t.stack}`)}_ErrorHandlerOllamaServer(t,r,i,s,c){throw t in[this._RouteApiShow,this._RouteApiGenerate,this._RouteApiChat]&&r===404?new Mr(hi.message,c):r===400?new tt(i.error,t,r,s):r===500?new tt(i.error,t,r):new tt(i.error,t,r)}async OllamaApiVersion(){let t=this._RouteApiVersion,r=`${this._server}${t}`,i={headers:this._headers,signal:this._signal};return(await ae(r,i).then(c=>c.json()).then(c=>c).catch(c=>{throw this._ErrorLogger(c),c.type==="ECONNREFUSED"?ve:pi})).version}async OllamaApiTags(){let t=this._RouteApiTags,r=`${this._server}${t}`,i={headers:this._headers,signal:this._signal};return await ae(r,i).then(async c=>{if(!c.ok){let u=await c.json();this._ErrorHandlerOllamaServer(t,c.status,u)}return c.json()}).then(c=>c).catch(c=>{throw this._ErrorLogger(c),c instanceof H&&c.type==="ECONNREFUSED"?ve:c})}async OllamaApiShow(t){let r=this._RouteApiShow,i=`${this._server}${r}`,c={method:"POST",headers:{"Content-Type":"application/json",...this._headers},body:JSON.stringify({name:t})};return await ae(i,c).then(async d=>{if(!d.ok){let m=await d.json();this._ErrorHandlerOllamaServer(r,d.status,m,c,t)}return d.json()}).then(d=>d).catch(d=>{throw this._ErrorLogger(d),d instanceof H&&d.type==="ECONNREFUSED"?ve:d})}_OllamaApiShowParseModelfileFrom(t){let r=t.match(/^FROM[ ]+([a-zA-Z0-9:./]+)\n/m);return r?r[0]:""}_OllamaApiShowParseModelfileSystem(t){let r=t.search(/^SYSTEM[  ]+(.*)/m);if(r!==-1)return t.substring(r).split('"""')?.[1]}_OllamaApiShowParseModelfileLicense(t){let r=t.search(/^LICENSE[  ]+(.*)/m);if(r!==-1)return t.substring(r).split('"""')?.[1]}_OllamaApiShowParseModelfileParameterSplit(t){if(!t)return[];let r=t.split(`
`);return r||[]}_OllamaApiShowParseModelfileParameterMirostat(t){let r=t.filter(i=>i.search(/^mirostat[  ]+(.*)/m)!==-1).map(i=>i.match(/^mirostat[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):0}_OllamaApiShowParseModelfileParameterMirostatEta(t){let r=t.filter(i=>i.search(/^mirostat_eta[  ]+(.*)/m)!==-1).map(i=>i.match(/^mirostat_eta[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):.1}_OllamaApiShowParseModelfileParameterMirostatTau(t){let r=t.filter(i=>i.search(/^mirostat_tau[  ]+(.*)/m)!==-1).map(i=>i.match(/^mirostat_tau[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):5}_OllamaApiShowParseModelfileParameterNumCtx(t){let r=t.filter(i=>i.search(/^num_ctx[  ]+(.*)/m)!==-1).map(i=>i.match(/^num_ctx[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):2048}_OllamaApiShowParseModelfileParameterNumGqa(t){let r=t.filter(i=>i.search(/^num_gqa[  ]+(.*)/m)!==-1).map(i=>i.match(/^num_gqa[  ]+(.*)/m)?.[1])?.[0];if(r)return Number(r)}_OllamaApiShowParseModelfileParameterNumGpu(t){let r=t.filter(i=>i.search(/^num_gpu[  ]+(.*)/m)!==-1).map(i=>i.match(/^num_gpu[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):1}_OllamaApiShowParseModelfileParameterNumThread(t){let r=t.filter(i=>i.search(/^num_thread[  ]+(.*)/m)!==-1).map(i=>i.match(/^num_thread[  ]+(.*)/m)?.[1])?.[0];if(r)return Number(r)}_OllamaApiShowParseModelfileParameterRepeatLastN(t){let r=t.filter(i=>i.search(/^repeat_last_n[  ]+(.*)/m)!==-1).map(i=>i.match(/^repeat_last_n[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):64}_OllamaApiShowParseModelfileParameterRepeatPenalty(t){let r=t.filter(i=>i.search(/^repeat_penalty[  ]+(.*)/m)!==-1).map(i=>i.match(/^repeat_penalty[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):1.1}_OllamaApiShowParseModelfileParameterTemperature(t){let r=t.filter(i=>i.search(/^temperature[  ]+(.*)/m)!==-1).map(i=>i.match(/^temperature[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):.8}_OllamaApiShowParseModelfileParameterSeed(t){let r=t.filter(i=>i.search(/^seed[  ]+(.*)/m)!==-1).map(i=>i.match(/^seed[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):0}_OllamaApiShowParseModelfileParameterStop(t){let r=t.filter(i=>i.search(/^stop[  ]+(.*)/m)!==-1).map(i=>i.match(/^stop[  ]+(.*)/m)?.[1]);return r||[]}_OllamaApiShowParseModelfileParameterTfsZ(t){let r=t.filter(i=>i.search(/^tfs_z[  ]+(.*)/m)!==-1).map(i=>i.match(/^tfs_z[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):1}_OllamaApiShowParseModelfileParameterNumPredict(t){let r=t.filter(i=>i.search(/^num_predict[  ]+(.*)/m)!==-1).map(i=>i.match(/^num_predict[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):128}_OllamaApiShowParseModelfileParameterTopK(t){let r=t.filter(i=>i.search(/^top_k[  ]+(.*)/m)!==-1).map(i=>i.match(/^top_k[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):40}_OllamaApiShowParseModelfileParameterTopP(t){let r=t.filter(i=>i.search(/^top_p[  ]+(.*)/m)!==-1).map(i=>i.match(/^top_p[  ]+(.*)/m)?.[1])?.[0];return r?Number(r):.9}_OllamaApiShowParseModelfileParameterAdapter(t){let r=t.filter(i=>i.search(/^ADAPTER[  ]+(.*)/m)!==-1).map(i=>i.match(/^ADAPTER[  ]+(.*)/m)?.[1])?.[0];if(r)return r}OllamaApiShowParseModelfile(t){let r=this._OllamaApiShowParseModelfileParameterSplit(t.parameters);return{from:t.template&&this._OllamaApiShowParseModelfileFrom(t.template),parameter:{mirostat:r.length>0?this._OllamaApiShowParseModelfileParameterMirostat(r):0,mirostat_eta:r.length>0?this._OllamaApiShowParseModelfileParameterMirostatEta(r):.1,mirostat_tau:r.length>0?this._OllamaApiShowParseModelfileParameterMirostatTau(r):5,num_ctx:r.length>0?this._OllamaApiShowParseModelfileParameterNumCtx(r):2048,num_gqa:r.length>0?this._OllamaApiShowParseModelfileParameterNumGqa(r):void 0,num_gpu:r.length>0?this._OllamaApiShowParseModelfileParameterNumGpu(r):1,num_thread:r.length>0?this._OllamaApiShowParseModelfileParameterNumThread(r):void 0,repeat_last_n:r.length>0?this._OllamaApiShowParseModelfileParameterRepeatLastN(r):64,repeat_penalty:r.length>0?this._OllamaApiShowParseModelfileParameterRepeatPenalty(r):1.1,temperature:r.length>0?this._OllamaApiShowParseModelfileParameterTemperature(r):.8,seed:r.length>0?this._OllamaApiShowParseModelfileParameterSeed(r):0,stop:r.length>0?this._OllamaApiShowParseModelfileParameterStop(r):[],tfs_z:r.length>0?this._OllamaApiShowParseModelfileParameterTfsZ(r):1,num_predict:r.length>0?this._OllamaApiShowParseModelfileParameterNumPredict(r):128,top_k:r.length>0?this._OllamaApiShowParseModelfileParameterTopK(r):40,top_p:r.length>0?this._OllamaApiShowParseModelfileParameterTopP(r):.9},template:t.template,system:t.template&&this._OllamaApiShowParseModelfileSystem(t.template),adapter:this._OllamaApiShowParseModelfileParameterAdapter(r),license:t.template&&this._OllamaApiShowParseModelfileLicense(t.template)}}async OllamaApiDelete(t){let r=this._RouteApiDelete,i=`${this._server}${r}`,c={method:"DELETE",headers:{"Content-Type":"application/json",...this._headers},body:JSON.stringify({model:t})};await ae(i,c).then(async u=>{if(!u.ok){let d=await u.json();this._ErrorHandlerOllamaServer(r,u.status,d,c,t)}}).catch(u=>{throw this._ErrorLogger(u),u instanceof H&&u.type==="ECONNREFUSED"?ve:u})}async OllamaApiPull(t){let r=this._RouteApiPull,i=`${this._server}${r}`,s={method:"POST",headers:this._headers,body:JSON.stringify({name:t})},c;for(;c===void 0;)c=await ae(i,s).then(async u=>{if(!u.ok){let d=await u.json();this._ErrorHandlerOllamaServer(r,u.status,d,s,t)}return u.body}).then(u=>{if(u===void 0)return;let d=new jn.EventEmitter;return u?.on("data",m=>{if(m!==void 0){let h,g=Buffer.from(m);try{h=JSON.parse(g.toString())}catch(w){console.error(w)}h&&("total"in h&&h.total&&"completed"in h&&h.completed?d.emit("downloading",h.completed/h.total):"status"in h&&h.status==="success"?d.emit("done","Download completed"):"error"in h?d.emit("error",h.error):d.emit("message",h.status))}}),d}).catch(u=>{throw this._ErrorLogger(u),u instanceof H&&u.type==="ECONNREFUSED"?ve:u});return c}async _OllamaApiStream(t,r,i){let s=`${this._server}${t}`,c={method:"POST",headers:this._headers,body:JSON.stringify(r)},u;for(;u===void 0;){let d="";u=await ae(s,c).then(async m=>{if(!m.ok){let h=await m.json();this._ErrorHandlerOllamaServer(t,m.status,h,c,r.model)}return m.body}).then(m=>{if(m===void 0)return;let h=new jn.EventEmitter,g=w=>{if(w)if("done"in w)if(w.done)h.emit("done",w);else{let S=i(w);S&&h.emit("data",S)}else"error"in w&&w.error&&h.emit("error",w)};return m?.on("data",w=>{if(w!==void 0){let y=Buffer.from(w).toString();d!==""&&(y=d+y);for(let x of y.split(`
`).filter(T=>T!==""))try{let T=JSON.parse(x);g(T),d=""}catch(T){console.error(T),d+=x}}}),h}).catch(m=>{throw this._ErrorLogger(m),m instanceof H&&m.type==="ECONNREFUSED"?ve:m})}return u}async OllamaApiGenerate(t){return await this._OllamaApiStream(this._RouteApiGenerate,t,r=>{if(r&&"response"in r&&r.response)return r.response})}async OllamaApiGenerateNoStream(t){return await this._OllamaApiNoStream(this._RouteApiGenerate,t)}async OllamaApiChat(t){return await this._OllamaApiStream(this._RouteApiChat,t,r=>{if(r&&"message"in r&&r.message)return r.message.content})}async OllamaApiChatNoStream(t){return await this._OllamaApiNoStream(this._RouteApiChat,t)}async _OllamaApiNoStream(t,r){r.stream=!1;let i=`${this._server}${t}`,s={method:"POST",headers:this._headers,body:JSON.stringify(r)};return await ae(i,s).then(async u=>{if(!u.ok){let d=await u.json();this._ErrorHandlerOllamaServer(t,u.status,d,s,r.model)}return u.json()}).then(u=>u).catch(u=>{throw this._ErrorLogger(u),u instanceof H&&u.type==="ECONNREFUSED"?ve:u})}async OllamaApiEmbeddings(t,r){let i=this._RouteApiEmbeddings,s=`${this._server}${i}`,c={method:"POST",headers:this._headers,body:JSON.stringify({model:r,prompt:t})},u;for(;u===void 0;)u=await ae(s,c).then(async d=>{if(!d.ok){let m=await d.json();this._ErrorHandlerOllamaServer(i,d.status,m,c,r)}return d.json()}).then(async d=>{if(d!==void 0)return d}).catch(d=>{throw this._ErrorLogger(d),d instanceof H&&d.type==="ECONNREFUSED"?ve:d});return u}async OllamaApiPs(){let t=this._RouteApiPs,r=`${this._server}${t}`,i={method:"GET",headers:this._headers},s;for(;s===void 0;)s=await ae(r,i).then(async c=>{if(!c.ok){let u=await c.json();this._ErrorHandlerOllamaServer(t,c.status,u,i)}return c.json()}).then(async c=>{if(c!==void 0)return c}).catch(c=>{throw this._ErrorLogger(c),c instanceof H&&c.type==="ECONNREFUSED"?ve:c});return s}};var ee=require("@raycast/api");async function Yi(){let a=new Map;a.set("Local",{url:"http://127.0.0.1:11434"});let t=await ee.LocalStorage.getItem("settings_ollama_servers");return t&&(a=new Map([...a,...JSON.parse(t)])),a}async function ct(a){if(a==="Local")return{url:"http://127.0.0.1:11434"};let t=await ee.LocalStorage.getItem("settings_ollama_servers");if(!t)throw new Error("Given Ollama Server doesn't exist");let r=new Map([...JSON.parse(t)]);if(!r.has(a))throw new Error("Given Ollama Server doesn't exist");return r.get(a)}async function Ki(a){let t=await ee.LocalStorage.getItem(`settings_command_${a}`);if(t)return JSON.parse(t);throw new Error("Settings for this Command unavailable")}async function Qi(a,t){await ee.LocalStorage.setItem(`settings_command_${a}`,JSON.stringify(t))}async function Zi(a){let t=await zc().catch(()=>[]);t.unshift(a),await jc(t)}async function zc(){let a=await ee.LocalStorage.getItem("setting_command_chat");if(a)return JSON.parse(a);let t=await qc().catch(()=>{});if(t)return t;throw new Error("No saved chat")}async function jc(a){await ee.LocalStorage.setItem("setting_command_chat",JSON.stringify(a))}async function qc(){let a=await ee.LocalStorage.getItem("chat_history");a&&await ee.LocalStorage.removeItem("chat_history");let t=await ee.LocalStorage.getItem("chat_model_generate");t&&await ee.LocalStorage.removeItem("chat_model_generate");let r=await ee.LocalStorage.getItem("chat_model_embedding");r&&await ee.LocalStorage.removeItem("chat_model_embedding");let i=await ee.LocalStorage.getItem("chat_model_image");if(i&&await ee.LocalStorage.removeItem("chat_model_image"),a&&t)return[...new Map(JSON.parse(a)).entries()].map(c=>({name:c[0],models:{main:{server_name:"Local",server:{url:"http://127.0.0.1:11434"},tag:String(t)},embedding:r?{server_name:"Local",server:{url:"http://127.0.0.1:11434"},tag:String(r)}:void 0,vision:i?{server_name:"Local",server:{url:"http://127.0.0.1:11434"},tag:String(i)}:void 0},messages:c[1].map(u=>({images:u.images,files:u.sources,...u}))}));throw new Error("No saved chat")}var pe=require("@raycast/api");var z=require("@raycast/api");var Jt=new Error("Raycast Need Accessibility Permission for This Feature. Enable it under macOS Settings > Privacy & Security > Accessibility."),Xi=new Error("Raycast Browser Extensions Needed for This Feature."),eo=new Error("Selected Text Not Found."),to=new Error("Clipboard Text Not Found."),ro=new Error("Image Not Selected. At least one image need to be selected from Finder or in Clipboard.");var _o=X(require("fs"));var Vc="End-Of-Stream",N=class extends Error{constructor(){super(Vc)}};var Yt=class{constructor(){this.maxStreamReadSize=1*1024*1024,this.endOfStream=!1,this.peekQueue=[]}async peek(t,r,i){let s=await this.read(t,r,i);return this.peekQueue.push(t.subarray(r,r+s)),s}async read(t,r,i){if(i===0)return 0;let s=this.readFromPeekBuffer(t,r,i);if(s+=await this.readRemainderFromStream(t,r+s,i-s),s===0)throw new N;return s}readFromPeekBuffer(t,r,i){let s=i,c=0;for(;this.peekQueue.length>0&&s>0;){let u=this.peekQueue.pop();if(!u)throw new Error("peekData should be defined");let d=Math.min(u.length,s);t.set(u.subarray(0,d),r+c),c+=d,s-=d,d<u.length&&this.peekQueue.push(u.subarray(d))}return c}async readRemainderFromStream(t,r,i){let s=i,c=0;for(;s>0&&!this.endOfStream;){let u=Math.min(s,this.maxStreamReadSize),d=await this.readFromStream(t,r+c,u);if(d===0)break;c+=d,s-=d}return c}};var Kt=class extends Yt{constructor(t){super(),this.reader=t.getReader({mode:"byob"})}async readFromStream(t,r,i){if(this.endOfStream)throw new N;let s=await this.reader.read(new Uint8Array(i));return s.done&&(this.endOfStream=s.done),s.value?(t.set(s.value,r),s.value.byteLength):0}abort(){return this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}};var Le=class{constructor(t){this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=t?.onClose,t?.abortSignal&&t.abortSignal.addEventListener("abort",()=>{this.abort()})}async readToken(t,r=this.position){let i=new Uint8Array(t.len);if(await this.readBuffer(i,{position:r})<t.len)throw new N;return t.get(i,0)}async peekToken(t,r=this.position){let i=new Uint8Array(t.len);if(await this.peekBuffer(i,{position:r})<t.len)throw new N;return t.get(i,0)}async readNumber(t){if(await this.readBuffer(this.numBuffer,{length:t.len})<t.len)throw new N;return t.get(this.numBuffer,0)}async peekNumber(t){if(await this.peekBuffer(this.numBuffer,{length:t.len})<t.len)throw new N;return t.get(this.numBuffer,0)}async ignore(t){if(this.fileInfo.size!==void 0){let r=this.fileInfo.size-this.position;if(t>r)return this.position+=r,r}return this.position+=t,t}async close(){await this.abort(),await this.onClose?.()}normalizeOptions(t,r){if(r&&r.position!==void 0&&r.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return r?{mayBeLess:r.mayBeLess===!0,offset:r.offset?r.offset:0,length:r.length?r.length:t.length-(r.offset?r.offset:0),position:r.position?r.position:this.position}:{mayBeLess:!1,offset:0,length:t.length,position:this.position}}abort(){return Promise.resolve()}};var Gc=256e3,Jr=class extends Le{constructor(t,r){super(r),this.streamReader=t,this.fileInfo=r?.fileInfo??{}}async readBuffer(t,r){let i=this.normalizeOptions(t,r),s=i.position-this.position;if(s>0)return await this.ignore(s),this.readBuffer(t,r);if(s<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(i.length===0)return 0;let c=await this.streamReader.read(t,i.offset,i.length);if(this.position+=c,(!r||!r.mayBeLess)&&c<i.length)throw new N;return c}async peekBuffer(t,r){let i=this.normalizeOptions(t,r),s=0;if(i.position){let c=i.position-this.position;if(c>0){let u=new Uint8Array(i.length+c);return s=await this.peekBuffer(u,{mayBeLess:i.mayBeLess}),t.set(u.subarray(c),i.offset),s-c}if(c<0)throw new Error("Cannot peek from a negative offset in a stream")}if(i.length>0){try{s=await this.streamReader.peek(t,i.offset,i.length)}catch(c){if(r?.mayBeLess&&c instanceof N)return 0;throw c}if(!i.mayBeLess&&s<i.length)throw new N}return s}async ignore(t){let r=Math.min(Gc,t),i=new Uint8Array(r),s=0;for(;s<t;){let c=t-s,u=await this.readBuffer(i,{length:Math.min(r,c)});if(u<0)return u;s+=u}return s}abort(){return this.streamReader.abort()}supportsRandomAccess(){return!1}};var Yr=class extends Le{constructor(t,r){super(r),this.uint8Array=t,this.fileInfo={...r?.fileInfo??{},size:t.length}}async readBuffer(t,r){if(r?.position){if(r.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=r.position}let i=await this.peekBuffer(t,r);return this.position+=i,i}async peekBuffer(t,r){let i=this.normalizeOptions(t,r),s=Math.min(this.uint8Array.length-i.position,i.length);if(!i.mayBeLess&&s<i.length)throw new N;return t.set(this.uint8Array.subarray(i.position,i.position+s),i.offset),s}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(t){this.position=t}};function qn(a,t){return new Jr(new Kt(a),t)}function no(a,t){return new Yr(a,t)}var ao=require("node:fs/promises"),Qt=class a extends Le{static async fromFile(t){let r=await(0,ao.open)(t,"r"),i=await r.stat();return new a(r,{fileInfo:{path:t,size:i.size}})}constructor(t,r){super(r),this.fileHandle=t,this.fileInfo=r.fileInfo}async readBuffer(t,r){let i=this.normalizeOptions(t,r);if(this.position=i.position,i.length===0)return 0;let s=await this.fileHandle.read(t,i.offset,i.length,i.position);if(this.position+=s.bytesRead,s.bytesRead<i.length&&(!r||!r.mayBeLess))throw new N;return s.bytesRead}async peekBuffer(t,r){let i=this.normalizeOptions(t,r),s=await this.fileHandle.read(t,i.offset,i.length,i.position);if(!i.mayBeLess&&s.bytesRead<i.length)throw new N;return s.bytesRead}async close(){return await this.fileHandle.close(),super.close()}setPosition(t){this.position=t}supportsRandomAccess(){return!0}};var Yc=Qt.fromFile;var so=X(io(),1);var Hn={128:"\u20AC",130:"\u201A",131:"\u0192",132:"\u201E",133:"\u2026",134:"\u2020",135:"\u2021",136:"\u02C6",137:"\u2030",138:"\u0160",139:"\u2039",140:"\u0152",142:"\u017D",145:"\u2018",146:"\u2019",147:"\u201C",148:"\u201D",149:"\u2022",150:"\u2013",151:"\u2014",152:"\u02DC",153:"\u2122",154:"\u0161",155:"\u203A",156:"\u0153",158:"\u017E",159:"\u0178"},Qc={};for(let[a,t]of Object.entries(Hn))Qc[t]=Number.parseInt(a);function oo(a,t="utf-8"){switch(t.toLowerCase()){case"utf-8":case"utf8":return typeof globalThis.TextDecoder<"u"?new globalThis.TextDecoder("utf-8").decode(a):Zc(a);case"utf-16le":return Xc(a);case"ascii":return el(a);case"latin1":case"iso-8859-1":return tl(a);case"windows-1252":return rl(a);default:throw new RangeError(`Encoding '${t}' not supported`)}}function Zc(a){let t="",r=0;for(;r<a.length;){let i=a[r++];if(i<128)t+=String.fromCharCode(i);else if(i<224){let s=a[r++]&63;t+=String.fromCharCode((i&31)<<6|s)}else if(i<240){let s=a[r++]&63,c=a[r++]&63;t+=String.fromCharCode((i&15)<<12|s<<6|c)}else{let s=a[r++]&63,c=a[r++]&63,u=a[r++]&63,d=(i&7)<<18|s<<12|c<<6|u;d-=65536,t+=String.fromCharCode(55296+(d>>10&1023),56320+(d&1023))}}return t}function Xc(a){let t="";for(let r=0;r<a.length;r+=2)t+=String.fromCharCode(a[r]|a[r+1]<<8);return t}function el(a){return String.fromCharCode(...a.map(t=>t&127))}function tl(a){return String.fromCharCode(...a)}function rl(a){let t="";for(let r of a)r>=128&&r<=159&&Hn[r]?t+=Hn[r]:t+=String.fromCharCode(r);return t}function ie(a){return new DataView(a.buffer,a.byteOffset)}var co={len:1,get(a,t){return ie(a).getUint8(t)},put(a,t,r){return ie(a).setUint8(t,r),t+1}},Kr={len:2,get(a,t){return ie(a).getUint16(t,!0)},put(a,t,r){return ie(a).setUint16(t,r,!0),t+2}},Qr={len:2,get(a,t){return ie(a).getUint16(t)},put(a,t,r){return ie(a).setUint16(t,r),t+2}};var lo={len:4,get(a,t){return ie(a).getUint32(t,!0)},put(a,t,r){return ie(a).setUint32(t,r,!0),t+4}},uo={len:4,get(a,t){return ie(a).getUint32(t)},put(a,t,r){return ie(a).setUint32(t,r),t+4}};var fo={len:4,get(a,t){return ie(a).getInt32(t)},put(a,t,r){return ie(a).setInt32(t,r),t+4}};var mo={len:8,get(a,t){return ie(a).getBigUint64(t,!0)},put(a,t,r){return ie(a).setBigUint64(t,r,!0),t+8}};var ue=class{constructor(t,r){this.len=t,this.encoding=r}get(t,r=0){let i=t.subarray(r,r+this.len);return oo(i,this.encoding)}};var Ef={utf8:new globalThis.TextDecoder("utf8")};var Tf=new globalThis.TextEncoder;var vf=Array.from({length:256},(a,t)=>t.toString(16).padStart(2,"0"));function Gn(a){let{byteLength:t}=a;if(t===6)return a.getUint16(0)*2**32+a.getUint32(2);if(t===5)return a.getUint8(0)*2**32+a.getUint32(1);if(t===4)return a.getUint32(0);if(t===3)return a.getUint8(0)*2**16+a.getUint16(1);if(t===2)return a.getUint16(0);if(t===1)return a.getUint8(0)}function Jn(a,t){let r=a.length,i=t.length;if(i===0||i>r)return-1;let s=r-i;for(let c=0;c<=s;c++){let u=!0;for(let d=0;d<i;d++)if(a[c+d]!==t[d]){u=!1;break}if(u)return c}return-1}function ho(a,t){return Jn(a,t)!==-1}function po(a){return[...a].map(t=>t.charCodeAt(0))}function go(a,t=0){let r=Number.parseInt(new ue(6).get(a,148).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(r))return!1;let i=256;for(let s=t;s<t+148;s++)i+=a[s];for(let s=t+156;s<t+512;s++)i+=a[s];return r===i}var bo={get:(a,t)=>a[t+3]&127|a[t+2]<<7|a[t+1]<<14|a[t]<<21,len:4};var yo=["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx","vsdx","vtt","apk"],xo=["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","video/ogg","audio/ogg","audio/ogg; codecs=opus","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","text/vtt","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/x-parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx","application/vnd.visio","application/vnd.android.package-archive"];var wo=4100;async function Yn(a){return new Zr().fromBuffer(a)}function Ce(a,t,r){r={offset:0,...r};for(let[i,s]of t.entries())if(r.mask){if(s!==(r.mask[i]&a[i+r.offset]))return!1}else if(s!==a[i+r.offset])return!1;return!0}var Zr=class{constructor(t){this.detectors=t?.customDetectors,this.tokenizerOptions={abortSignal:t?.signal},this.fromTokenizer=this.fromTokenizer.bind(this),this.fromBuffer=this.fromBuffer.bind(this),this.parse=this.parse.bind(this)}async fromTokenizer(t){let r=t.position;for(let i of this.detectors||[]){let s=await i(t);if(s)return s;if(r!==t.position)return}return this.parse(t)}async fromBuffer(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof t}\``);let r=t instanceof Uint8Array?t:new Uint8Array(t);if(r?.length>1)return this.fromTokenizer(no(r,this.tokenizerOptions))}async fromBlob(t){return this.fromStream(t.stream())}async fromStream(t){let r=await qn(t,this.tokenizerOptions);try{return await this.fromTokenizer(r)}finally{await r.close()}}async toDetectionStream(t,r){let{sampleSize:i=wo}=r,s,c,u=t.getReader({mode:"byob"});try{let{value:h,done:g}=await u.read(new Uint8Array(i));if(c=h,!g&&h)try{s=await this.fromBuffer(h.slice(0,i))}catch(w){if(!(w instanceof N))throw w;s=void 0}c=h}finally{u.releaseLock()}let d=new TransformStream({async start(h){h.enqueue(c)},transform(h,g){g.enqueue(h)}}),m=t.pipeThrough(d);return m.fileType=s,m}check(t,r){return Ce(this.buffer,t,r)}checkString(t,r){return this.check(po(t),r)}async parse(t){if(this.buffer=new Uint8Array(wo),t.fileInfo.size===void 0&&(t.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=t,await t.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await t.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.parse(t);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await t.ignore(6);let r=await t.readToken(bo);return t.position+r>t.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await t.ignore(r),this.fromTokenizer(t))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((this.buffer[0]===67||this.buffer[0]===70)&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){try{for(;t.position+30<t.fileInfo.size;){await t.readBuffer(this.buffer,{length:30});let r=new DataView(this.buffer.buffer),i={compressedSize:r.getUint32(18,!0),uncompressedSize:r.getUint32(22,!0),filenameLength:r.getUint16(26,!0),extraFieldLength:r.getUint16(28,!0)};if(i.filename=await t.readToken(new ue(i.filenameLength,"utf-8")),await t.ignore(i.extraFieldLength),/classes\d*\.dex/.test(i.filename))return{ext:"apk",mime:"application/vnd.android.package-archive"};if(i.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if(i.filename.endsWith(".rels")||i.filename.endsWith(".xml"))switch(i.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};case"visio":return{ext:"vsdx",mime:"application/vnd.visio"};default:break}if(i.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(i.filename.startsWith("3D/")&&i.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if(i.filename==="mimetype"&&i.compressedSize===i.uncompressedSize){let s=await t.readToken(new ue(i.compressedSize,"utf-8"));switch(s=s.trim(),s){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}}if(i.compressedSize===0){let s=-1;for(;s<0&&t.position<t.fileInfo.size;)await t.peekBuffer(this.buffer,{mayBeLess:!0}),s=Jn(this.buffer,new Uint8Array([80,75,3,4])),await t.ignore(s>=0?s:this.buffer.length)}else await t.ignore(i.compressedSize)}}catch(r){if(!(r instanceof N))throw r}return{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await t.ignore(28);let r=new Uint8Array(8);return await t.readBuffer(r),Ce(r,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/ogg; codecs=opus"}:Ce(r,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:Ce(r,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:Ce(r,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:Ce(r,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:Ce(r,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(this.buffer[2]===3||this.buffer[2]===5||this.buffer[2]===7)&&(this.buffer[3]===4||this.buffer[3]===6||this.buffer[3]===8))return{ext:"zip",mime:"application/zip"};if(this.checkString("ftyp",{offset:4})&&(this.buffer[8]&96)!==0){let r=new ue(4,"latin1").get(this.buffer,8).replace("\0"," ").trim();switch(r){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return r.startsWith("3g")?r.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF")){try{await t.ignore(1350);let r=10*1024*1024,i=new Uint8Array(Math.min(r,t.fileInfo.size));if(await t.readBuffer(i,{mayBeLess:!0}),ho(i,new TextEncoder().encode("AIPrivateData")))return{ext:"ai",mime:"application/postscript"}}catch(r){if(!(r instanceof N))throw r}return{ext:"pdf",mime:"application/pdf"}}if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){let r=await this.readTiffHeader(!1);if(r)return r}if(this.check([77,77])){let r=await this.readTiffHeader(!0);if(r)return r}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function r(){let d=await t.peekNumber(co),m=128,h=0;for(;(d&m)===0&&m!==0;)++h,m>>=1;let g=new Uint8Array(h+1);return await t.readBuffer(g),g}async function i(){let d=await r(),m=await r();m[0]^=128>>m.length-1;let h=Math.min(6,m.length),g=new DataView(d.buffer),w=new DataView(m.buffer,m.length-h,h);return{id:Gn(g),len:Gn(w)}}async function s(d){for(;d>0;){let m=await i();if(m.id===17026)return(await t.readToken(new ue(m.len))).replaceAll(/\00.*$/g,"");await t.ignore(m.len),--d}}let c=await i();switch(await s(c.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(this.check([82,73,70,70])){if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1"))return{ext:"parquet",mime:"application/x-parquet"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(this.buffer[6]===0||this.buffer[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){let r=new ue(4,"latin1").get(this.buffer,2);if(r.match("^d*")&&r>=1e3&&r<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>"))return await t.ignore(8),await t.readToken(new ue(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(this.checkString("WEBVTT")&&[`
`,"\r","	"," ","\0"].some(r=>this.checkString(r,{offset:6})))return{ext:"vtt",mime:"text/vtt"};if(this.check([137,80,78,71,13,10,26,10])){await t.ignore(8);async function r(){return{length:await t.readToken(fo),type:await t.readToken(new ue(4,"latin1"))}}do{let i=await r();if(i.length<0)return;switch(i.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await t.ignore(i.length+4)}}while(t.position+8<t.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function r(){let i=new Uint8Array(16);return await t.readBuffer(i),{id:i,size:Number(await t.readToken(mo))}}for(await t.ignore(30);t.position+24<t.fileInfo.size;){let i=await r(),s=i.size-24;if(Ce(i.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){let c=new Uint8Array(16);if(s-=await t.readBuffer(c),Ce(c,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(Ce(c,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await t.ignore(s)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await t.ignore(20),await t.readToken(new ue(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await t.peekBuffer(this.buffer,{length:Math.min(256,t.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("**ACE",{offset:7})&&this.checkString("**",{offset:12}))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){let r=new DataView(this.buffer.buffer).getUint32(12,!0);if(r>12&&this.buffer.length>=r+16)try{let i=new TextDecoder().decode(this.buffer.slice(16,r+16));if(JSON.parse(i).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.checkString("Kaydara FBX Binary  \0"))return{ext:"fbx",mime:"application/x.autodesk.fbx"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await t.peekBuffer(this.buffer,{length:Math.min(512,t.fileInfo.size),mayBeLess:!0}),go(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254]))return this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0;if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(this.buffer.length>=2&&this.check([255,224],{offset:0,mask:[255,224]})){if(this.check([16],{offset:1,mask:[22]}))return this.check([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}async readTiffTag(t){let r=await this.tokenizer.readToken(t?Qr:Kr);switch(this.tokenizer.ignore(10),r){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"};default:}}async readTiffIFD(t){let r=await this.tokenizer.readToken(t?Qr:Kr);for(let i=0;i<r;++i){let s=await this.readTiffTag(t);if(s)return s}}async readTiffHeader(t){let r=(t?Qr:Kr).get(this.buffer,2),i=(t?uo:lo).get(this.buffer,4);if(r===42){if(i>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(i>=8&&(this.check([28,0,254,0],{offset:8})||this.check([31,0,11,0],{offset:8})))return{ext:"nef",mime:"image/x-nikon-nef"}}return await this.tokenizer.ignore(i),await this.readTiffIFD(t)??{ext:"tif",mime:"image/tiff"}}if(r===43)return{ext:"tif",mime:"image/tiff"}}},al=new Set(yo),il=new Set(xo);async function ol(){let a=new Map;return(await Yi()).forEach((r,i)=>a.set(i,new st(r))),a}async function Ro(){let a=new Map,t=await ol();return await Promise.all([...t.entries()].map(async r=>{let i=await r[1].OllamaApiTags().catch(async s=>{await(0,z.showToast)({style:z.Toast.Style.Failure,title:`'${r[0]}' Server`,message:s.message})});i&&a.set(r[0],await Promise.all(i.models.map(async s=>{let c=await r[1].OllamaApiShow(s.name).catch(async u=>{await(0,z.showToast)({style:z.Toast.Style.Failure,title:`'${r[0]}' Server`,message:u.message})});return{name:s.name,capabilities:c&&c.capabilities}})))})),a}async function ko(a){let t=await ct(a);return(await new st(t).OllamaApiTags()).models}async function Eo(a){let t=await sl(a);t&&(a=t);let r=await cl(a);return r&&(a=r),a}async function To(a){let t=/{[ ]*image[ ]*}/i;if(a.match(t)){let r=await ll();if(!r||r.length===0)throw ro;return[a.replace(t,""),r]}}async function sl(a){let t=/{[ ]*selection[ ]*}/i;if(a.match(t)){let r=await fl();r&&(a=a.replace(t,r))}return a}async function cl(a){let t=/{[ ]*browser-tab[ ]*(?:[ ]+format="(html|markdown|text)"[ ]*)?}/i;if(a.match(t)){if(!z.environment.canAccess(z.BrowserExtension))throw Xi;let r=a.match(t),i=await z.BrowserExtension.getContent({format:`${r?.groups&&r.groups[1]?r.groups[1]:"markdown"}`});a=a.replace(t,i)}return a}async function ll(){let a=[];if(!z.environment.canAccess(z.getSelectedFinderItems))throw Jt;let t=await(0,z.getSelectedFinderItems)().catch(()=>[]);if(t.length>0){let r=t.map(async s=>So(s.path).catch(()=>{}));(await Promise.all(r)).forEach(s=>{s&&a.push(s)})}else{if(!z.environment.canAccess(z.Clipboard))throw Jt;let r=await z.Clipboard.read();if(r.file){let i=await So(r.file);i&&a.push(i)}else if(r.text){let i=await ul(r.text);i&&a.push(i)}}return a}async function So(a){if(!a.match(/(file:)?([/|.|\w|\s|-])/g))throw new Error("Only PNG and JPG are supported");a=a.replace("file://","");let t=_o.default.readFileSync(decodeURI(a)),r=await Yn(t);if(r&&(r.mime==="image/jpeg"||r.mime==="image/png"))return{path:a,html:`<img src="${a}" alt="image" height="180" width="auto">`,base64:t.toString("base64")};throw new Error("Only PNG and JPG are supported")}async function ul(a){if(!a.match(/(http(s?):)([/|.|\w|\s|-])/g))throw new Error("Clipboard do not contain file path or web url");return await ae(a).then(r=>{let i=r.headers.get("content-type");if(i==="image/jpeg"||i==="image/png")return r.arrayBuffer();throw new Error("Only PNG and JPG are supported")}).then(r=>({path:a,html:`<img src="${a}" alt="image" height="180" width="auto">`,base64:Buffer.from(r).toString("base64")}))}async function vo(a=!1){if(!z.environment.canAccess(z.getSelectedText))throw Jt;return await(0,z.getSelectedText)().catch(async()=>{if(!a)throw eo;return await Ao()})}async function Ao(a=!1){if(!z.environment.canAccess(z.Clipboard))throw Jt;return await z.Clipboard.readText().catch(async()=>{if(!a)throw to;return await vo()})}async function fl(){let a,t=(0,z.getPreferenceValues)();switch(t.ollamaResultViewInput){case"SelectedText":a=await vo(t.ollamaResultViewInputFallback);break;case"Clipboard":a=await Ao(t.ollamaResultViewInputFallback);break}return a}async function $o(a,t,r){let i;if(a)i=await Ki(a),t=i.server,r=i.model.main.tag;else if(!t||!r)throw new Error("server and model need to be defined");let s=await ct(t),c=(await ko(t)).filter(u=>u.name===r);if(c.length<1)throw new Error("Model unavailable on given server");return{server:{name:t,ollama:new st(s)},tag:c[0],keep_alive:i?.model.main.keep_alive}}async function Co(a,t,r,i,s,c=!0){let u=await ct(a.server.name),d={name:t?`${t.substring(0,25)}...`:"New Chat",models:{main:{server:u,server_name:a.server.name,tag:a.tag.name,keep_alive:a.keep_alive}},messages:[{messages:[{role:"user",content:t||"",images:r?r.map(m=>m.base64):void 0},{role:"assistant",content:i}],images:r,...s}]};await Zi(d),c&&await(0,pe.launchCommand)({name:"ollama-chat",type:pe.LaunchType.UserInitiated})}async function ml(a,t,r,i,s,c=void 0,u=.8,d){await(0,pe.showToast)({style:pe.Toast.Style.Animated,title:"\u{1F9E0} Inference."});let m={model:a.tag.name,prompt:t,images:c,options:{temperature:u}};d&&(m.keep_alive=d),a.server.ollama.OllamaApiGenerate(m).then(async h=>{h.on("data",g=>{i(w=>w+g)}),h.on("done",async g=>{await(0,pe.showToast)({style:pe.Toast.Style.Success,title:"\u{1F9E0} Inference Done."}),s(g),r(!1)})}).catch(async h=>{await(0,pe.showToast)({style:pe.Toast.Style.Failure,title:h}),r(!1)})}async function Po(a,t,r,i,s,c,u,d,m=.8,h){s(!0);let g=await To(t);if(g){let w=g[1];c(""),w.forEach(S=>{c(y=>y+S.html)}),c(S=>S+`
`),i.current=g[1]}t=await Eo(t),r.current=t,u(""),await ml(a,t,s,u,d,g&&g[1]?g[1].map(w=>w.base64):void 0,m,h)}var lt=require("@raycast/api"),Xr={New:lt.Keyboard.Shortcut.Common.New,Edit:lt.Keyboard.Shortcut.Common.Edit,Copy:lt.Keyboard.Shortcut.Common.Copy,Remove:lt.Keyboard.Shortcut.Common.Remove,CopyName:lt.Keyboard.Shortcut.Common.CopyName,ToggleQuickLook:lt.Keyboard.Shortcut.Common.ToggleQuickLook,AttachText:{macOS:{modifiers:["cmd"],key:"t"},Windows:{modifiers:["ctrl"],key:"t"}},AttachBrowserTab:{macOS:{modifiers:["cmd"],key:"b"},Windows:{modifiers:["ctrl"],key:"b"}},AttachImage:{macOS:{modifiers:["cmd"],key:"i"},Windows:{modifiers:["ctrl"],key:"i"}},ChangeModel:{macOS:{modifiers:["cmd"],key:"m"},Windows:{modifiers:["ctrl"],key:"m"}},UpdateModel:{macOS:{modifiers:["cmd"],key:"u"},Windows:{modifiers:["ctrl"],key:"u"}},OpenLibrary:{macOS:{modifiers:["cmd"],key:"l"},Windows:{modifiers:["ctrl"],key:"l"}}};var te=require("@raycast/api");var Bo=X(require("react"));var Oo=`How many the model need to stay in memory, by default 5 minutes. Can be configured as follow:
- 0s, memory is free when inference is done.
- -1s, model remains on memory permanently.
- 5s, memory is free after 5 seconds of idle.
- 5m, memory is free after 5 minutes of idle.
- 5h, memory is free after 5 hours of idle.
- 5.5h, memory is free after 5 hours and 30 minutes of idle.`;function Io(a,t){if(a){if(!t)return"The item is required";if(!t.match(/^-{0,1}(?:[0-9]+(?:\.{0,1}[0-9]+){0,1}(?:h|m|s|ms|us|ns){1})$/g))return"Wrong Format"}}var ge=require("react/jsx-runtime");function Fo(a){let{data:t,isLoading:r}=Dr(Ro,[],{onData:g=>{a.server===void 0||a.model===void 0||g.has(a.server)&&(c("server",a.server),g.get(a.server).filter(S=>!(!S.capabilities||!a.capabilities||S.capabilities.length<a.capabilities.length||a.capabilities.length!==S.capabilities.filter(y=>a.capabilities&&a.capabilities.findIndex(x=>x===y)!==-1).length))?.some(S=>S.name===a.model)&&c("model",a.model))}}),{handleSubmit:i,itemProps:s,setValue:c}=mi({onSubmit(g){h(g)},initialValues:{keep_alive:a.keep_alive?a.keep_alive:"5m"},validation:{server:On.Required,model:On.Required,keep_alive:g=>Io(u,g)}}),[u,d]=Bo.useState(!!a.keep_alive),m=(0,ge.jsxs)(te.ActionPanel,{children:[(0,ge.jsx)(te.Action.SubmitForm,{onSubmit:i}),(0,ge.jsx)(te.Action,{title:"Close",icon:te.Icon.Xmark,onAction:()=>a.setShow(!1)})]});async function h(g){let w=await ct(g.server),S={server:g.server,model:{main:{server:w,tag:g.model,keep_alive:u?g.keep_alive:void 0}}};await Qi(a.command,S),a.revalidate(),a.setShow(!1)}return(0,ge.jsxs)(te.Form,{actions:m,isLoading:r,children:[!r&&t&&(0,ge.jsx)(te.Form.Dropdown,{title:"Server",...s.server,children:[...t.keys()].sort().map(g=>(0,ge.jsx)(te.Form.Dropdown.Item,{title:g,value:g},g))}),!r&&t&&s.server.value&&(0,ge.jsx)(te.Form.Dropdown,{title:"Model",...s.model,children:s.server.value&&t.get(s.server.value).filter(g=>!(!g.capabilities||!a.capabilities||g.capabilities.length<a.capabilities.length||a.capabilities.length!==g.capabilities.filter(w=>a.capabilities&&a.capabilities.findIndex(S=>S===w)!==-1).length)).sort().map(g=>(0,ge.jsx)(te.Form.Dropdown.Item,{title:g.name,value:g.name},g.name))}),(0,ge.jsx)(te.Form.Checkbox,{id:"advanced",label:"Advanced Settings",defaultValue:u,onChange:d}),u&&(0,ge.jsx)(te.Form.TextField,{title:"Keep Alive",info:Oo,...s.keep_alive})]})}var W=require("react/jsx-runtime");function Do(a){let{data:t,revalidate:r,isLoading:i}=Dr($o,[a.command,a.server,a.model],{onError:_=>{(_.message==="Settings for this Command unavailable"||_.message==="Model unavailable on given server"||_.message=="Verify Ollama is Installed and Currently Running.")&&k(!0),(0,C.showToast)({style:C.Toast.Style.Failure,title:_.message})}}),[s,c]=fe.useState(!1),u=fe.useRef(),d=fe.useRef(),[m,h]=fe.useState(""),[g,w]=fe.useState(""),[S,y]=fe.useState({}),[x,T]=fe.useState(!1);fe.useEffect(()=>{t&&!i&&Po(t,a.prompt,u,d,c,h,w,y,a.creativity,a.keep_alive?a.keep_alive:t.keep_alive).catch(async _=>{await(0,C.showToast)({style:C.Toast.Style.Failure,title:"Error",message:_}),c(!1)})},[t,i]);let[A,k]=fe.useState(!1);if(fe.useEffect(()=>{A||r()},[A]),A&&a.command)return(0,W.jsx)(Fo,{command:a.command,setShow:k,revalidate:r,capabilities:a.capabilities,server:!i&&t?t.server.name:void 0,model:!i&&t?t.tag.name:void 0,keep_alive:!i&&t?t.keep_alive:void 0});function E(){return(0,W.jsxs)(C.ActionPanel,{title:"Actions",children:[(0,W.jsx)(C.Action.CopyToClipboard,{content:g}),(0,W.jsx)(C.Action,{title:x?"Hide Metadata":"Show Metadata",icon:x?C.Icon.EyeDisabled:C.Icon.Eye,shortcut:Xr.ToggleQuickLook,onAction:()=>T(_=>!_)}),a.command&&(0,W.jsx)(C.Action,{title:"Change Model",icon:C.Icon.Box,onAction:()=>k(!0),shortcut:Xr.ChangeModel}),t&&!s&&g&&(0,W.jsx)(C.Action,{title:"Continue as Chat",icon:C.Icon.SpeechBubble,onAction:async()=>await Co(t,u.current,d.current,g,S),shortcut:Xr.New})]})}function O(_){return(0,W.jsxs)(C.Detail.Metadata,{children:[(0,W.jsx)(C.Detail.Metadata.Label,{title:"Model",text:_.tag.name}),(0,W.jsx)(C.Detail.Metadata.Label,{title:"Family",text:_.tag.details.family}),_.tag.details.families&&_.tag.details.families.length>0&&(0,W.jsx)(C.Detail.Metadata.TagList,{title:"Families",children:_.tag.details.families.map(I=>(0,W.jsx)(C.Detail.Metadata.TagList.Item,{text:I}))}),(0,W.jsx)(C.Detail.Metadata.Label,{title:"Parameter Size",text:_.tag.details.parameter_size}),(0,W.jsx)(C.Detail.Metadata.Label,{title:"Quantization Level",text:_.tag.details.quantization_level}),(0,W.jsx)(C.Detail.Metadata.Separator,{}),_.answer.eval_count&&_.answer.eval_duration?(0,W.jsx)(C.Detail.Metadata.Label,{title:"Generation Speed",text:`${(_.answer.eval_count/(_.answer.eval_duration/1e9)).toFixed(2)} token/s`}):null,_.answer.total_duration?(0,W.jsx)(C.Detail.Metadata.Label,{title:"Total Inference Duration",text:`${(_.answer.total_duration/1e9).toFixed(2)}s`}):null,_.answer.load_duration?(0,W.jsx)(C.Detail.Metadata.Label,{title:"Load Duration",text:`${(_.answer.load_duration/1e9).toFixed(2)}s`}):null,_.answer.prompt_eval_count?(0,W.jsx)(C.Detail.Metadata.Label,{title:"Prompt Eval Count",text:`${_.answer.prompt_eval_count}`}):null,_.answer.prompt_eval_duration?(0,W.jsx)(C.Detail.Metadata.Label,{title:"Prompt Eval Duration",text:`${(_.answer.prompt_eval_duration/1e9).toFixed(2)}s`}):null,_.answer.eval_count?(0,W.jsx)(C.Detail.Metadata.Label,{title:"Eval Count",text:`${_.answer.eval_count}`}):null,_.answer.eval_duration?(0,W.jsx)(C.Detail.Metadata.Label,{title:"Eval Duration",text:`${(_.answer.eval_duration/1e9).toFixed(2)}s`}):null]})}return g===""?(0,W.jsxs)(C.List,{isLoading:s||i,actions:!s&&!i&&(0,W.jsx)(E,{}),children:["",(0,W.jsx)(C.List.EmptyView,{icon:C.Icon.CircleProgress,title:"Loading Model"})]}):(0,W.jsx)(C.Detail,{markdown:`${m}${g}`,isLoading:s||i,actions:!s&&!i&&(0,W.jsx)(E,{}),metadata:!s&&!i&&t&&S&&x&&(0,W.jsx)(O,{answer:S,tag:t.tag})})}var Mo=require("@raycast/api");var Lo=require("react/jsx-runtime"),hl=(0,Mo.getPreferenceValues)();hl.ollamaCertificateValidation||(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0");function Uo(a){let t="translate",r=`Translate the text in ${a.arguments.language}.

Text: {selection}

Translation:`;return(0,Lo.jsx)(Do,{command:t,prompt:r,creativity:.2,capabilities:["completion"]})}
/*! Bundled license information:

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/
