"use strict";var fe=Object.create;var V=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var pe=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty;var ge=(e,t)=>{for(var r in t)V(e,r,{get:t[r],enumerable:!0})},K=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let f of he(t))!me.call(e,f)&&f!==r&&V(e,f,{get:()=>t[f],enumerable:!(a=de(t,f))||a.enumerable});return e};var z=(e,t,r)=>(r=e!=null?fe(pe(e)):{},K(t||!e||!e.__esModule?V(r,"default",{value:e,enumerable:!0}):r,e)),be=e=>K(V({},"__esModule",{value:!0}),e);var Se={};ge(Se,{default:()=>ne});module.exports=be(Se);var p=require("@raycast/api");var n=z(require("react")),s=require("@raycast/api");var H=Object.prototype.hasOwnProperty;function F(e,t){var r,a;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((a=e.length)===t.length)for(;a--&&F(e[a],t[a]););return a===-1}if(!r||typeof e=="object"){a=0;for(r in e)if(H.call(e,r)&&++a&&!H.call(t,r)||!(r in t)||!F(e[r],t[r]))return!1;return Object.keys(t).length===a}}return e!==e&&t!==t}var U=z(require("node:fs")),j=z(require("node:path"));var X=require("react/jsx-runtime");function $e(e){let t=(0,n.useRef)(e),r=(0,n.useRef)(0);return F(e,t.current)||(t.current=e,r.current+=1),(0,n.useMemo)(()=>t.current,[r.current])}function x(e){let t=(0,n.useRef)(e);return t.current=e,t}function G(e,t){let r=e instanceof Error?e.message:String(e);return(0,s.showToast)({style:s.Toast.Style.Failure,title:t?.title??"Something went wrong",message:t?.message??r,primaryAction:t?.primaryAction??Z(e),secondaryAction:t?.primaryAction?Z(e):void 0})}var Z=e=>{let t=!0,r="[Extension Name]...",a="";try{let c=JSON.parse((0,U.readFileSync)((0,j.join)(s.environment.assetsPath,"..","package.json"),"utf8"));r=`[${c.title}]...`,a=`https://raycast.com/${c.owner||c.author}/${c.name}`,(!c.owner||c.access==="public")&&(t=!1)}catch{}let f=s.environment.isDevelopment||t,o=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:f?"Copy Logs":"Report Error",onAction(c){c.hide(),f?s.Clipboard.copy(o):(0,s.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(a)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${o}
\`\`\`
`)}`)}}};function ye(e,t,r){let a=(0,n.useRef)(0),[f,o]=(0,n.useState)({isLoading:!0}),c=x(e),h=x(r?.abortable),l=x(t||[]),$=x(r?.onError),u=x(r?.onData),k=x(r?.onWillExecute),O=x(r?.failureToastOptions),P=x(f.data),_=(0,n.useRef)(null),y=(0,n.useRef)({page:0}),L=(0,n.useRef)(!1),b=(0,n.useRef)(!0),d=(0,n.useRef)(50),m=(0,n.useCallback)(()=>(h.current&&(h.current.current?.abort(),h.current.current=new AbortController),++a.current),[h]),w=(0,n.useCallback)((...A)=>{let S=m();k.current?.(A),o(i=>({...i,isLoading:!0}));let M=we(c.current)(...A);function N(i){return i.name=="AbortError"||S===a.current&&($.current?$.current(i):s.environment.launchType!==s.LaunchType.Background&&G(i,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(T){T.hide(),_.current?.(...l.current||[])}},...O.current}),o({error:i,isLoading:!1})),i}return typeof M=="function"?(L.current=!0,M(y.current).then(({data:i,hasMore:T,cursor:le})=>(S===a.current&&(y.current&&(y.current.cursor=le,y.current.lastItem=i?.[i.length-1]),u.current&&u.current(i,y.current),T&&(d.current=i.length),b.current=T,o(ue=>y.current.page===0?{data:i,isLoading:!1}:{data:(ue.data||[])?.concat(i),isLoading:!1})),i),i=>(b.current=!1,N(i)))):(L.current=!1,M.then(i=>(S===a.current&&(u.current&&u.current(i),o({data:i,isLoading:!1})),i),N))},[u,$,l,c,o,_,k,y,O,m]);_.current=w;let v=(0,n.useCallback)(()=>{y.current={page:0};let A=l.current||[];return w(...A)},[w,l]),C=(0,n.useCallback)(async(A,S)=>{let M;try{if(S?.optimisticUpdate){m(),typeof S?.rollbackOnError!="function"&&S?.rollbackOnError!==!1&&(M=structuredClone(P.current?.value));let N=S.optimisticUpdate;o(i=>({...i,data:N(i.data)}))}return await A}catch(N){if(typeof S?.rollbackOnError=="function"){let i=S.rollbackOnError;o(T=>({...T,data:i(T.data)}))}else S?.optimisticUpdate&&S?.rollbackOnError!==!1&&o(i=>({...i,data:M}));throw N}finally{S?.shouldRevalidateAfter!==!1&&(s.environment.launchType===s.LaunchType.Background||s.environment.commandMode==="menu-bar"?await v():v())}},[v,P,o,m]),se=(0,n.useCallback)(()=>{y.current.page+=1;let A=l.current||[];w(...A)},[y,l,w]);(0,n.useEffect)(()=>{y.current={page:0},r?.execute!==!1?w(...t||[]):m()},[$e([t,r?.execute,w]),h,y]),(0,n.useEffect)(()=>()=>{m()},[m]);let ie=r?.execute!==!1?f.isLoading:!1,oe={...f,isLoading:ie},ce=L.current?{pageSize:d.current,hasMore:b.current,onLoadMore:se}:void 0;return{...oe,revalidate:v,mutate:C,pagination:ce}}function we(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function ke(e,t){let r=this[e];return r instanceof Date?`__raycast_cached_date__${r.toISOString()}`:Buffer.isBuffer(r)?`__raycast_cached_buffer__${r.toString("base64")}`:t}function ve(e,t){return typeof t=="string"&&t.startsWith("__raycast_cached_date__")?new Date(t.replace("__raycast_cached_date__","")):typeof t=="string"&&t.startsWith("__raycast_cached_buffer__")?Buffer.from(t.replace("__raycast_cached_buffer__",""),"base64"):t}function B(e,t){if(e){if(typeof e=="function")return e(t);if(e==="required"){let r=typeof t<"u"&&t!==null;if(r)switch(typeof t){case"string":r=t.length>0;break;case"object":Array.isArray(t)?r=t.length>0:t instanceof Date&&(r=t.getTime()>0);break;default:break}if(!r)return"The item is required"}}}function q(e){let{onSubmit:t,validation:r,initialValues:a={}}=e,[f,o]=(0,n.useState)(a),[c,h]=(0,n.useState)({}),l=(0,n.useRef)({}),$=x(r||{}),u=x(t),k=(0,n.useCallback)(b=>{l.current[b]?.focus()},[l]),O=(0,n.useCallback)(async b=>{let d=!1;for(let[w,v]of Object.entries($.current)){let C=B(v,b[w]);C&&(d||(d={},k(w)),d[w]=C)}if(d)return h(d),!1;let m=await u.current(b);return typeof m=="boolean"?m:!0},[$,u,k]),P=(0,n.useCallback)((b,d)=>{h(m=>({...m,[b]:d}))},[h]),_=(0,n.useCallback)(function(b,d){o(m=>({...m,[b]:typeof d=="function"?d(m[b]):d}))},[o]),y=(0,n.useMemo)(()=>new Proxy({},{get(b,d){let m=$.current[d],w=f[d];return{onChange(v){c[d]&&(B(m,v)||P(d,void 0)),_(d,v)},onBlur(v){let C=B(m,v.target.value);C&&P(d,C)},error:c[d],id:d,value:typeof w>"u"?null:w,ref:v=>{l.current[d]=v}}}}),[c,$,P,f,l,_]),L=(0,n.useCallback)(b=>{h({}),Object.entries(l.current).forEach(([d,m])=>{b?.[d]||m?.reset()}),b&&o(b)},[o,h,l]);return{handleSubmit:O,setValidationError:P,setValue:_,values:f,itemProps:y,focus:k,reset:L}}function Y(e,t){let{data:r,isLoading:a,mutate:f}=ye(async h=>{let l=await s.LocalStorage.getItem(h);return typeof l<"u"?JSON.parse(l,ve):t},[e]);async function o(h){try{await f(s.LocalStorage.setItem(e,JSON.stringify(h,ke)),{optimisticUpdate(l){return l}})}catch(l){await G(l,{title:"Failed to set value in local storage"})}}async function c(){try{await f(s.LocalStorage.removeItem(e),{optimisticUpdate(){}})}catch(h){await G(h,{title:"Failed to remove value from local storage"})}}return{value:r,setValue:o,removeValue:c,isLoading:a}}var W=z(require("react"));var E=require("@raycast/api");function Q(e,t){if(!t||!e.mcpServers[t])return"";let r={mcpServers:{}};return r.mcpServers[t]=e.mcpServers[t],JSON.stringify(r,null,2)}var R=require("react/jsx-runtime");function J(e){let{handleSubmit:t,itemProps:r}=q({async onSubmit(o){let c=JSON.parse(JSON.stringify(e.config));e.configName&&delete c.mcpServers[e.configName];let h=JSON.parse(o.config);Object.keys(h.mcpServers).forEach(l=>{c.mcpServers[l]=h.mcpServers[l]}),await e.setConfig(c),e.setShow(!1)},initialValues:{config:Q(e.config,e.configName)},validation:{config:a}});function a(o){if(!o)return"Empty Config.";let c;try{c=JSON.parse(o)}catch(u){return`Wrong Mcp Server Config JSON Format: ${u}.`}let h=Object.keys(e.config.mcpServers),l=Object.keys(c.mcpServers),$=h.find(u=>l.findIndex(k=>u===k&&k!==e.configName)!==-1);if($)return`Mcp Server "${$}" already configured.`}function f(){return(0,R.jsxs)(E.ActionPanel,{children:[(0,R.jsx)(E.Action.SubmitForm,{onSubmit:t}),(0,R.jsx)(E.Action,{title:"Undo",icon:E.Icon.Undo,onAction:()=>e.setShow(!1)})]})}return(0,R.jsx)(E.Form,{actions:(0,R.jsx)(f,{}),children:(0,R.jsx)(E.Form.TextArea,{title:"Mcp Server Config",info:"Copy Mcp Server config in json format",autoFocus:!0,...r.config})})}async function ee(e,t,r){let a=structuredClone(t);delete a.mcpServers[e],await r(a)}function te(e,t){let r={mcpServers:{}};return r.mcpServers[t]=e.mcpServers[t],r}var I=require("@raycast/api"),D={New:I.Keyboard.Shortcut.Common.New,Edit:I.Keyboard.Shortcut.Common.Edit,Copy:I.Keyboard.Shortcut.Common.Copy,Remove:I.Keyboard.Shortcut.Common.Remove,CopyName:I.Keyboard.Shortcut.Common.CopyName,ToggleQuickLook:I.Keyboard.Shortcut.Common.ToggleQuickLook,AttachText:{macOS:{modifiers:["cmd"],key:"t"},Windows:{modifiers:["ctrl"],key:"t"}},AttachBrowserTab:{macOS:{modifiers:["cmd"],key:"b"},Windows:{modifiers:["ctrl"],key:"b"}},AttachImage:{macOS:{modifiers:["cmd"],key:"i"},Windows:{modifiers:["ctrl"],key:"i"}},ChangeModel:{macOS:{modifiers:["cmd"],key:"m"},Windows:{modifiers:["ctrl"],key:"m"}},UpdateModel:{macOS:{modifiers:["cmd"],key:"u"},Windows:{modifiers:["ctrl"],key:"u"}},OpenLibrary:{macOS:{modifiers:["cmd"],key:"l"},Windows:{modifiers:["ctrl"],key:"l"}}};var g=require("react/jsx-runtime");function re(){let{value:e,setValue:t,isLoading:r}=Y("mcp_server_config",{mcpServers:{}}),[a,f]=W.default.useState(!1),[o,c]=W.default.useState(!1);function h(u){return(0,g.jsx)(p.ActionPanel,{children:(0,g.jsxs)(p.ActionPanel.Section,{title:"Mcp Server",children:[e&&(0,g.jsx)(p.Action,{title:"Show Detail",icon:o?p.Icon.EyeDisabled:p.Icon.Eye,shortcut:D.ToggleQuickLook,onAction:()=>c(k=>!k)}),e&&(0,g.jsx)(p.Action,{title:"Add",icon:p.Icon.Plus,shortcut:D.New,onAction:()=>f(!0)}),u.mcpServerName&&e&&(0,g.jsx)(p.Action,{title:"Edit",icon:p.Icon.Pencil,shortcut:D.Edit,onAction:()=>{$.current=(0,g.jsx)(J,{setShow:f,config:e,setConfig:t,configName:u.mcpServerName}),f(!0)}}),u.mcpServerName&&e&&(0,g.jsxs)(p.ActionPanel.Submenu,{title:"Delete",icon:p.Icon.Trash,shortcut:D.Remove,children:[(0,g.jsx)(p.Action,{title:`Yes, Delete "${u.mcpServerName}" Mcp Server`,icon:p.Icon.CheckCircle,onAction:async()=>{await ee(u.mcpServerName,e,t)}}),(0,g.jsx)(p.Action,{title:"No",icon:p.Icon.XMarkCircle})]})]})})}function l(u){let k=te(u.config,u.name),O=`\`\`\`JSON
${JSON.stringify(k,null,2)}
\`\`\``;return(0,g.jsx)(p.List.Item.Detail,{markdown:O})}let $=W.default.useRef();return W.default.useEffect(()=>{e&&!a&&($.current=(0,g.jsx)(J,{setShow:f,config:e,setConfig:t}))},[e,a]),a&&e&&$.current?$.current:(0,g.jsx)(p.List,{isLoading:r||!e,isShowingDetail:o,actions:(0,g.jsx)(h,{}),children:e&&Object.keys(e.mcpServers).length>0?Object.keys(e.mcpServers).map(u=>(0,g.jsx)(p.List.Item,{title:u,icon:p.Icon.WrenchScrewdriver,id:u,detail:(0,g.jsx)(l,{config:e,name:u}),actions:(0,g.jsx)(h,{mcpServerName:u})},u)):(0,g.jsx)(p.List.EmptyView,{icon:p.Icon.WrenchScrewdriver,title:"No Mcp Server configured",description:"You can add new Mcp Server using \u2318+N (macOS) or ctrl+N (Windows) shortcut."})})}var ae=require("react/jsx-runtime");function ne(){return(0,ae.jsx)(re,{})}
