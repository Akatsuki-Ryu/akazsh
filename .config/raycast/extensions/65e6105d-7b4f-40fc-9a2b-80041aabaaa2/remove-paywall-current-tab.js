"use strict";var X=Object.create;var y=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var ne=(t,e)=>{for(var r in e)y(t,r,{get:e[r],enumerable:!0})},T=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of ee(e))!re.call(t,a)&&a!==r&&y(t,a,{get:()=>e[a],enumerable:!(n=Q(e,a))||n.enumerable});return t};var b=(t,e,r)=>(r=t!=null?X(te(t)):{},T(e||!t||!t.__esModule?y(r,"default",{value:t,enumerable:!0}):r,t)),ae=t=>T(y({},"__esModule",{value:!0}),t);var pe={};ne(pe,{default:()=>K});module.exports=ae(pe);var g=require("@raycast/api");var C="https://12ft.io";var f=b(require("react")),o=require("@raycast/api");var d=b(require("node:fs")),k=b(require("node:path"));var D=b(require("node:child_process")),W=require("node:buffer"),p=b(require("node:stream")),z=require("node:util");var V=require("react/jsx-runtime");var S=globalThis;function m(t,e){let r=t instanceof Error?t.message:String(t);return(0,o.showToast)({style:o.Toast.Style.Failure,title:e?.title??"Something went wrong",message:e?.message??r,primaryAction:e?.primaryAction??I(t),secondaryAction:e?.primaryAction?I(t):void 0})}var I=t=>{let e=!0,r="[Extension Name]...",n="";try{let s=JSON.parse((0,d.readFileSync)((0,k.join)(o.environment.assetsPath,"..","package.json"),"utf8"));r=`[${s.title}]...`,n=`https://raycast.com/${s.owner||s.author}/${s.name}`,(!s.owner||s.access==="public")&&(e=!1)}catch{}let a=o.environment.isDevelopment||e,i=t instanceof Error?t?.stack||t?.message||"":String(t);return{title:a?"Copy Logs":"Report Error",onAction(s){s.hide(),a?o.Clipboard.copy(i):(0,o.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${i}
\`\`\`
`)}`)}}};var w=t=>!!t&&typeof t=="object"&&typeof t.removeListener=="function"&&typeof t.emit=="function"&&typeof t.reallyExit=="function"&&typeof t.listeners=="function"&&typeof t.kill=="function"&&typeof t.pid=="number"&&typeof t.on=="function",E=Symbol.for("signal-exit emitter"),A=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),S[E])return S[E];Object.defineProperty(S,E,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(e,r){this.listeners[e].push(r)}removeListener(e,r){let n=this.listeners[e],a=n.indexOf(r);a!==-1&&(a===0&&n.length===1?n.length=0:n.splice(a,1))}emit(e,r,n){if(this.emitted[e])return!1;this.emitted[e]=!0;let a=!1;for(let i of this.listeners[e])a=i(r,n)===!0||a;return e==="exit"&&(a=this.emit("afterExit",r,n)||a),a}},U=class{onExit(){return()=>{}}load(){}unload(){}},P=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(e){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new A,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=e,this.#a={};for(let r of this.#r)this.#a[r]=()=>{let n=this.#e.listeners(r),{count:a}=this.#t,i=e;if(typeof i.__signal_exit_emitter__=="object"&&typeof i.__signal_exit_emitter__.count=="number"&&(a+=i.__signal_exit_emitter__.count),n.length===a){this.unload();let s=this.#t.emit("exit",null,r),c=r==="SIGHUP"?this.#o:r;s||e.kill(e.pid,c)}};this.#i=e.reallyExit,this.#s=e.emit}onExit(e,r){if(!w(this.#e))return()=>{};this.#n===!1&&this.load();let n=r?.alwaysLast?"afterExit":"exit";return this.#t.on(n,e),()=>{this.#t.removeListener(n,e),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let e of this.#r)try{let r=this.#a[e];r&&this.#e.on(e,r)}catch{}this.#e.emit=(e,...r)=>this.#l(e,...r),this.#e.reallyExit=e=>this.#c(e)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(e=>{let r=this.#a[e];if(!r)throw new Error("Listener not defined for signal: "+e);try{this.#e.removeListener(e,r)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(e){return w(this.#e)?(this.#e.exitCode=e||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(e,...r){let n=this.#s;if(e==="exit"&&w(this.#e)){typeof r[0]=="number"&&(this.#e.exitCode=r[0]);let a=n.call(this.#e,e,...r);return this.#t.emit("exit",this.#e.exitCode,null),a}else return n.call(this.#e,e,...r)}},R=null,se=(t,e)=>(R||(R=w(process)?new P(process):new U),R.onExit(t,e));function ie(t,{timeout:e}={}){let r=new Promise((c,l)=>{t.on("exit",(u,h)=>{c({exitCode:u,signal:h,timedOut:!1})}),t.on("error",u=>{l(u)}),t.stdin&&t.stdin.on("error",u=>{l(u)})}),n=se(()=>{t.kill()});if(e===0||e===void 0)return r.finally(()=>n());let a,i=new Promise((c,l)=>{a=setTimeout(()=>{t.kill("SIGTERM"),l(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},e)}),s=r.finally(()=>{clearTimeout(a)});return Promise.race([i,s]).finally(()=>n())}var _=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function oe(t){let{encoding:e}=t,r=e==="buffer",n=new p.default.PassThrough({objectMode:!1});e&&e!=="buffer"&&n.setEncoding(e);let a=0,i=[];return n.on("data",s=>{i.push(s),a+=s.length}),n.getBufferedValue=()=>r?Buffer.concat(i,a):i.join(""),n.getBufferedLength=()=>a,n}async function O(t,e){let r=oe(e);return await new Promise((n,a)=>{let i=s=>{s&&r.getBufferedLength()<=W.constants.MAX_LENGTH&&(s.bufferedData=r.getBufferedValue()),a(s)};(async()=>{try{await(0,z.promisify)(p.default.pipeline)(t,r),n()}catch(s){i(s)}})(),r.on("data",()=>{r.getBufferedLength()>8e7&&i(new _)})}),r.getBufferedValue()}async function L(t,e){t.destroy();try{return await e}catch(r){return r.bufferedData}}async function ce({stdout:t,stderr:e},{encoding:r},n){let a=O(t,{encoding:r}),i=O(e,{encoding:r});try{return await Promise.all([n,a,i])}catch(s){return Promise.all([{error:s,exitCode:null,signal:s.signal,timedOut:s.timedOut||!1},L(t,a),L(e,i)])}}function le(t){let e=typeof t=="string"?`
`:10,r=typeof t=="string"?"\r":13;return t[t.length-1]===e&&(t=t.slice(0,-1)),t[t.length-1]===r&&(t=t.slice(0,-1)),t}function M(t,e){return t.stripFinalNewline?le(e):e}function ue({timedOut:t,timeout:e,signal:r,exitCode:n}){return t?`timed out after ${e} milliseconds`:r!=null?`was killed with ${r}`:n!=null?`failed with exit code ${n}`:"failed"}function fe({stdout:t,stderr:e,error:r,signal:n,exitCode:a,command:i,timedOut:s,options:c,parentError:l}){let h=`Command ${ue({timedOut:s,timeout:c?.timeout,signal:n,exitCode:a})}: ${i}`,$=r?`${h}
${r.message}`:h,v=[$,e,t].filter(Boolean).join(`
`);return r?r.originalMessage=r.message:r=l,r.message=v,r.shortMessage=$,r.command=i,r.exitCode=a,r.signal=n,r.stdout=t,r.stderr=e,"bufferedData"in r&&delete r.bufferedData,r}function de({stdout:t,stderr:e,error:r,exitCode:n,signal:a,timedOut:i,command:s,options:c,parentError:l}){if(r||n!==0||a!==null)throw fe({error:r,exitCode:n,signal:a,stdout:t,stderr:e,command:s,timedOut:i,options:c,parentError:l});return t}async function x(t,e,r){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:n,language:a,timeout:i,...s}=Array.isArray(e)?r||{}:e||{},c=n!==!1?[]:["-ss"];a==="JavaScript"&&c.push("-l","JavaScript"),Array.isArray(e)&&c.push("-",...e);let l=D.default.spawn("osascript",c,{...s,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),u=ie(l,{timeout:i??1e4});l.stdin.end(t);let[{error:h,exitCode:$,signal:v,timedOut:H},Z,J]=await ce(l,{encoding:"utf8"},u),q=M({stripFinalNewline:!0},Z),Y=M({stripFinalNewline:!0},J);return de({stdout:q,stderr:Y,error:h,exitCode:$,signal:v,timedOut:H,command:"osascript",options:r,parentError:new Error})}var N=require("@raycast/api");var he={Safari:{engine:"webkit"},Orion:{engine:"webkit"},"Orion RC":{engine:"webkit"},"Google Chrome":{engine:"chromium"},"Microsoft Edge":{engine:"chromium"},"Brave Browser":{engine:"chromium"},Vivaldi:{engine:"chromium"},Arc:{engine:"chromium"},firefox:{engine:"gecko"},zen:{engine:"gecko"}};async function F(){let t='tell application "System Events" to get name of first application process whose frontmost is true',e;try{e=await x(t)}catch(n){throw await m(n,{title:"Error Getting Active App",message:"Could not determine the frontmost application."}),new Error("Script failed to get frontmost application name.")}let r=he[e];return r?{name:e,engine:r.engine}:{name:e,engine:"chromium"}}async function j(){let t=await F(),e=t.name.replace(/"/g,'""'),r="";t.engine==="webkit"?r=`tell application "${e}" to return URL of current tab of front window`:t.engine==="chromium"?r=`tell application "${e}" to return URL of active tab of front window`:t.engine==="gecko"&&(r=`
      tell application "${e}"
        activate
      end tell
      tell application "System Events"
        keystroke "l" using command down
        keystroke "c" using command down
        delay 0.1
      end tell
      return the clipboard
    `);try{return await x(r)}catch(n){throw await m(n,{title:`Failed to get URL from ${t.name}`,message:"Make sure the browser is running and a tab is active."}),new Error(`Could not get URL from ${t.name}`)}}async function B(t){let e=await F(),r=t.replace(/"/g,'""'),a=`tell application "${e.name.replace(/"/g,'""')}" to open location "${r}"`;try{await x(a)}catch(i){throw await m(i,{title:`Failed to open URL in ${e.name}`,message:"Make sure the browser is running."}),new Error(`Could not open URL in ${e.name}`)}}function G(t,e){if(t.includes("medium.com"))return`https://freedium-mirror.cfd/${t}`;if(!e?.startsWith("https://"))throw new Error("Preferred service must start with https://");return`${e}/${t}`}async function K(){try{let t=(0,g.getPreferenceValues)(),e=await j(),r=G(e,t.service||C);await(0,g.closeMainWindow)(),await B(r),await(0,g.showHUD)("Paywall Removed")}catch(t){await m(t,{title:"Failed to remove paywall"})}}
